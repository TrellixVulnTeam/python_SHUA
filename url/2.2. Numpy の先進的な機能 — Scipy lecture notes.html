<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <title>2.2. Numpy の先進的な機能 — Scipy lecture notes</title>
    
    <link rel="stylesheet" href="2.2.%20Numpy%20%E3%81%AE%E5%85%88%E9%80%B2%E7%9A%84%E3%81%AA%E6%A9%9F%E8%83%BD%20%E2%80%94%20Scipy%20lecture%20notes_files/nature.css" type="text/css">
    <link rel="stylesheet" href="2.2.%20Numpy%20%E3%81%AE%E5%85%88%E9%80%B2%E7%9A%84%E3%81%AA%E6%A9%9F%E8%83%BD%20%E2%80%94%20Scipy%20lecture%20notes_files/pygments.css" type="text/css">
    
    <script src="2.2.%20Numpy%20%E3%81%AE%E5%85%88%E9%80%B2%E7%9A%84%E3%81%AA%E6%A9%9F%E8%83%BD%20%E2%80%94%20Scipy%20lecture%20notes_files/async-ads.js" async=""></script><script src="2.2.%20Numpy%20%E3%81%AE%E5%85%88%E9%80%B2%E7%9A%84%E3%81%AA%E6%A9%9F%E8%83%BD%20%E2%80%94%20Scipy%20lecture%20notes_files/cse.js" async="" type="text/javascript"></script><script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2015.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="2.2.%20Numpy%20%E3%81%AE%E5%85%88%E9%80%B2%E7%9A%84%E3%81%AA%E6%A9%9F%E8%83%BD%20%E2%80%94%20Scipy%20lecture%20notes_files/jquery.js"></script>
    <script type="text/javascript" src="2.2.%20Numpy%20%E3%81%AE%E5%85%88%E9%80%B2%E7%9A%84%E3%81%AA%E6%A9%9F%E8%83%BD%20%E2%80%94%20Scipy%20lecture%20notes_files/underscore.js"></script>
    <script type="text/javascript" src="2.2.%20Numpy%20%E3%81%AE%E5%85%88%E9%80%B2%E7%9A%84%E3%81%AA%E6%A9%9F%E8%83%BD%20%E2%80%94%20Scipy%20lecture%20notes_files/doctools.js"></script>
    <script type="text/javascript" src="2.2.%20Numpy%20%E3%81%AE%E5%85%88%E9%80%B2%E7%9A%84%E3%81%AA%E6%A9%9F%E8%83%BD%20%E2%80%94%20Scipy%20lecture%20notes_files/copybutton.js"></script>
    <script type="text/javascript" src="2.2.%20Numpy%20%E3%81%AE%E5%85%88%E9%80%B2%E7%9A%84%E3%81%AA%E6%A9%9F%E8%83%BD%20%E2%80%94%20Scipy%20lecture%20notes_files/translations.js"></script>
    <script id="" src="2.2.%20Numpy%20%E3%81%AE%E5%85%88%E9%80%B2%E7%9A%84%E3%81%AA%E6%A9%9F%E8%83%BD%20%E2%80%94%20Scipy%20lecture%20notes_files/MathJax.js"></script>
    <link rel="top" title="Scipy lecture notes" href="http://www.turbare.net/transl/scipy-lecture-notes/index.html">
    <link rel="up" title="2. 先進的な話題" href="http://www.turbare.net/transl/scipy-lecture-notes/advanced/index.html">
    <link rel="next" title="2.3. コードのデバッグ" href="http://www.turbare.net/transl/scipy-lecture-notes/advanced/debugging/index.html">
    <link rel="prev" title="2.1. Python の先進的機能を構成するもの" href="http://www.turbare.net/transl/scipy-lecture-notes/advanced/advanced_python/index.html">
   
    <link rel="stylesheet" href="2.2.%20Numpy%20%E3%81%AE%E5%85%88%E9%80%B2%E7%9A%84%E3%81%AA%E6%A9%9F%E8%83%BD%20%E2%80%94%20Scipy%20lecture%20notes_files/base-min.css">

<script type="text/javascript">
$(function () {
    // Highlight the table of content as we scroll
    sections = {},
    i        = 0,
    url	 = document.URL.replace(/#.*$/, ""),
    current_section = 0;

    // Grab positions of our sections
    $('.headerlink').each(function(){
        sections[this.href.replace(url, '')] = $(this).offset().top - 50;
    });

    $(window).scroll(function(event) {
	var pos   = $(window).scrollTop();

	// Highlight the current section
	$('a.internal').parent().removeClass('active');
        for(i in sections){
            if(sections[i] > pos){
		break;
            };
	    if($('a.internal[href$="' + i + '"]').is(':visible')){
		current_section = i;
	    };
        }
	$('a.internal[href$="' + current_section + '"]').parent().addClass('active');
	$('a.internal[href$="' + current_section + '"]').parent().parent().parent().addClass('active');
	$('a.internal[href$="' + current_section + '"]').parent().parent().parent().parent().parent().addClass('active');
    });

});
</script>


  <script type="text/javascript" src="2.2.%20Numpy%20%E3%81%AE%E5%85%88%E9%80%B2%E7%9A%84%E3%81%AA%E6%A9%9F%E8%83%BD%20%E2%80%94%20Scipy%20lecture%20notes_files/jsapi"></script><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1px; bottom: 2px; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><link rel="stylesheet" href="2.2.%20Numpy%20%E3%81%AE%E5%85%88%E9%80%B2%E7%9A%84%E3%81%AA%E6%A9%9F%E8%83%BD%20%E2%80%94%20Scipy%20lecture%20notes_files/defaulten.css" type="text/css"><link rel="stylesheet" href="2.2.%20Numpy%20%E3%81%AE%E5%85%88%E9%80%B2%E7%9A%84%E3%81%AA%E6%A9%9F%E8%83%BD%20%E2%80%94%20Scipy%20lecture%20notes_files/default.css" type="text/css"><script src="2.2.%20Numpy%20%E3%81%AE%E5%85%88%E9%80%B2%E7%9A%84%E3%81%AA%E6%A9%9F%E8%83%BD%20%E2%80%94%20Scipy%20lecture%20notes_files/defaulten.js" type="text/javascript"></script><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">
.gsc-control-cse {
font-family: Arial, sans-serif;
border-color: #FFFFFF;
background-color: #FFFFFF;
}
.gsc-control-cse .gsc-table-result {
font-family: Arial, sans-serif;
}
input.gsc-input, .gsc-input-box, .gsc-input-box-hover, .gsc-input-box-focus {
border-color: #D9D9D9;
}
input.gsc-search-button, input.gsc-search-button:hover, input.gsc-search-button:focus {
border-color: #666666;
background-color: #CECECE;
background-image: none;
filter: none;
}
.gsc-tabHeader.gsc-tabhInactive {
border-color: #E9E9E9;
background-color: #E9E9E9;
}
.gsc-tabHeader.gsc-tabhActive {
border-color: #FF9900;
border-bottom-color: #FFFFFF;
background-color: #FFFFFF;
}
.gsc-tabsArea {
border-color: #FF9900;
}
.gsc-webResult.gsc-result,
.gsc-results .gsc-imageResult {
border-color: #FFFFFF;
background-color: #FFFFFF;
}
.gsc-webResult.gsc-result:hover,
.gsc-imageResult:hover {
border-color: #FFFFFF;
background-color: #FFFFFF;
}
.gs-webResult.gs-result a.gs-title:link,
.gs-webResult.gs-result a.gs-title:link b,
.gs-imageResult a.gs-title:link,
.gs-imageResult a.gs-title:link b {
color: #0000CC;
}
.gs-webResult.gs-result a.gs-title:visited,
.gs-webResult.gs-result a.gs-title:visited b,
.gs-imageResult a.gs-title:visited,
.gs-imageResult a.gs-title:visited b {
color: #0000CC;
}
.gs-webResult.gs-result a.gs-title:hover,
.gs-webResult.gs-result a.gs-title:hover b,
.gs-imageResult a.gs-title:hover,
.gs-imageResult a.gs-title:hover b {
color: #0000CC;
}
.gs-webResult.gs-result a.gs-title:active,
.gs-webResult.gs-result a.gs-title:active b,
.gs-imageResult a.gs-title:active,
.gs-imageResult a.gs-title:active b {
color: #0000CC;
}
.gsc-cursor-page {
color: #0000CC;
}
a.gsc-trailing-more-results:link {
color: #0000CC;
}
.gs-webResult .gs-snippet,
.gs-imageResult .gs-snippet,
.gs-fileFormatType {
color: #000000;
}
.gs-webResult div.gs-visibleUrl,
.gs-imageResult div.gs-visibleUrl {
color: #008000;
}
.gs-webResult div.gs-visibleUrl-short {
color: #008000;
}
.gs-webResult div.gs-visibleUrl-short {
display: none;
}
.gs-webResult div.gs-visibleUrl-long {
display: block;
}
.gs-promotion div.gs-visibleUrl-short {
display: none;
}
.gs-promotion div.gs-visibleUrl-long {
display: block;
}
.gsc-cursor-box {
border-color: #FFFFFF;
}
.gsc-results .gsc-cursor-box .gsc-cursor-page {
border-color: #E9E9E9;
background-color: #FFFFFF;
color: #0000CC;
}
.gsc-results .gsc-cursor-box .gsc-cursor-current-page {
border-color: #FF9900;
background-color: #FFFFFF;
color: #0000CC;
}
.gsc-webResult.gsc-result.gsc-promotion {
border-color: #336699;
background-color: #FFFFFF;
}
.gsc-completion-title {
color: #0000CC;
}
.gsc-completion-snippet {
color: #000000;
}
.gs-promotion a.gs-title:link,
.gs-promotion a.gs-title:link *,
.gs-promotion .gs-snippet a:link {
color: #0000CC;
}
.gs-promotion a.gs-title:visited,
.gs-promotion a.gs-title:visited *,
.gs-promotion .gs-snippet a:visited {
color: #0000CC;
}
.gs-promotion a.gs-title:hover,
.gs-promotion a.gs-title:hover *,
.gs-promotion .gs-snippet a:hover {
color: #0000CC;
}
.gs-promotion a.gs-title:active,
.gs-promotion a.gs-title:active *,
.gs-promotion .gs-snippet a:active {
color: #0000CC;
}
.gs-promotion .gs-snippet,
.gs-promotion .gs-title .gs-promotion-title-right,
.gs-promotion .gs-title .gs-promotion-title-right * {
color: #000000;
}
.gs-promotion .gs-visibleUrl,
.gs-promotion .gs-visibleUrl-short {
color: #008000;
}</style><style type="text/css">.gscb_a{display:inline-block;font:27px/13px arial,sans-serif}.gsst_a .gscb_a{color:#a1b9ed;cursor:pointer}.gsst_a:hover .gscb_a,.gsst_a:focus .gscb_a{color:#36c}.gsst_a{display:inline-block}.gsst_a{cursor:pointer;padding:0 4px}.gsst_a:hover{text-decoration:none!important}.gsst_b{font-size:16px;padding:0 2px;position:relative;user-select:none;-moz-user-select:none;white-space:nowrap}.gsst_e{opacity:0.55;}.gsst_a:hover .gsst_e,.gsst_a:focus .gsst_e{opacity:0.72;}.gsst_a:active .gsst_e{opacity:1;}.gsst_f{background:white;text-align:left}.gsst_g{background-color:white;border:1px solid #ccc;border-top-color:#d9d9d9;box-shadow:0 2px 4px rgba(0,0,0,0.2);-moz-box-shadow:0 2px 4px rgba(0,0,0,0.2);margin:-1px -3px;padding:0 6px}.gsst_h{background-color:white;height:1px;margin-bottom:-1px;position:relative;top:-1px}.gsib_a{width:100%;padding:4px 6px 0}.gsib_a,.gsib_b{vertical-align:top}.gssb_c{border:0;position:absolute;z-index:989}.gssb_e{border:1px solid #ccc;border-top-color:#d9d9d9;box-shadow:0 2px 4px rgba(0,0,0,0.2);-moz-box-shadow:0 2px 4px rgba(0,0,0,0.2);cursor:default}.gssb_f{visibility:hidden;white-space:nowrap}.gssb_k{border:0;display:block;position:absolute;top:0;z-index:988}.gsdd_a{border:none!important}.gsq_a{padding:0}.gsq_a{padding:0}.gscsep_a{display:none}.gssb_a{padding:0 7px}.gssb_a,.gssb_a td{white-space:nowrap;overflow:hidden;line-height:22px}#gssb_b{font-size:11px;color:#36c;text-decoration:none}#gssb_b:hover{font-size:11px;color:#36c;text-decoration:underline}.gssb_g{text-align:center;padding:8px 0 7px;position:relative}.gssb_h{font-size:15px;height:28px;margin:0.2em}.gssb_i{background:#eee}.gss_ifl{visibility:hidden;padding-left:5px}.gssb_i .gss_ifl{visibility:visible}a.gssb_j{font-size:13px;color:#36c;text-decoration:none;line-height:100%}a.gssb_j:hover{text-decoration:underline}.gssb_l{height:1px;background-color:#e5e5e5}.gssb_m{color:#000;background:#fff}.gsfe_a{border:1px solid #b9b9b9;border-top-color:#a0a0a0;box-shadow:inset 0px 1px 2px rgba(0,0,0,0.1);-moz-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.1);-webkit-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.1);}.gsfe_b{border:1px solid #4d90fe;outline:none;box-shadow:inset 0px 1px 2px rgba(0,0,0,0.3);-moz-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.3);-webkit-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.3);}.gssb_a{padding:0 9px}.gsib_a{padding-right:8px;padding-left:8px}.gsst_a{padding-top:3px}.gssb_e{border:0}.gssb_l{margin:5px 0}#gsc-i-id1::-webkit-input-placeholder{font-size:14px}#gsc-i-id1:-moz-placeholder{font-size:14px}#gsc-i-id1::-moz-placeholder{font-size:14px}#gsc-i-id1:-ms-input-placeholder{font-size:14px}#gsc-i-id1:focus::-webkit-input-placeholder{color:transparent}#gsc-i-id1:focus:-moz-placeholder{color:transparent}#gsc-i-id1:focus::-moz-placeholder{color:transparent}#gsc-i-id1:focus:-ms-input-placeholder{color:transparent}.gssb_c .gsc-completion-container{position:static}.gssb_c{z-index:5000}.gsc-completion-container table{background:transparent;font-size:inherit;font-family:inherit}.gssb_c > tbody > tr,.gssb_c > tbody > tr > td,.gssb_d,.gssb_d > tbody > tr,.gssb_d > tbody > tr > td,.gssb_e,.gssb_e > tbody > tr,.gssb_e > tbody > tr > td{padding:0;margin:0;border:0}.gssb_a table,.gssb_a table tr,.gssb_a table tr td{padding:0;margin:0;border:0}</style><style type="text/css">.MathJax_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax.MathJax_FullWidth {text-align: center; display: table-cell!important; width: 10000em!important}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_ExBox {display: block!important; overflow: hidden; width: 1px; height: 60ex; min-height: 0; max-height: none}
.MathJax .MathJax_EmBox {display: block!important; overflow: hidden; width: 1px; height: 60em; min-height: 0; max-height: none}
.MathJax_LineBox {display: table!important}
.MathJax_LineBox span {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Blank; src: url('about:blank')}
.MathJax .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style></head>
  <body role="document"><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px none; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"></div></div><div style="display: none;" id="MathJax_Message"></div>
   <!-- Use the header to add javascript -->
    

    <script type="text/javascript">
    // Function to collapse the tip divs
    function collapse_tip_div(obj){
	// Update the representation on the tip div based on whether it
	// has the 'collapsed' css class or not: we only want to
	// collapse divs that are not already collapsed
	if($(obj).hasClass("collapsed")) {
	} else {
	    $(obj).find("p.summary").remove();
	    var content = $(obj).text();
	    var html = $(obj).html();

	    if(content.length > 40) {
		if ($.browser.msie) {
		    // We start at '3' to avoid 'tip', as IE
		    // does not count whitespace
		    var content = content.substr(3, 50);
		} else {
		    // We start at '5' to avoid 'tip '
		    var content = content.substr(5, 50);
		}
	    }
	    $(obj).html('<p class="summary"><img src="../../_static/plus.png">' + content + '...</p>' + html);
	}
    }
    </script>

    <script type="text/javascript">
    $(function () {
	$(".tip")
	    .click(function(event){
		$(this).toggleClass("collapsed");
		// Change state of the global button
		$('div.related li.transparent').removeClass('transparent')
		$(this).find("p.summary").remove();
		if($(this).hasClass("collapsed")) {
		    var content = $(this).text();
		    var html = $(this).html();

		    if(content.length > 40) {
			if ($.browser.msie) {
			    // We start at '3' to avoid 'tip', as IE
			    // does not count whitespace
			    var content = content.substr(3, 50);
			} else {
			    // We start at '5' to avoid 'tip '
			    var content = content.substr(5, 50);
			}
		    }
		    $(this).html('<p class="summary"><img src="../../_static/plus.png">' + content + '...</p>' + html);
		}
		if (event.target.tagName.toLowerCase() != "a") {
                   return true; //Makes links clickable
		}
	});
    });
    </script>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="http://www.turbare.net/transl/scipy-lecture-notes/advanced/debugging/index.html" title="2.3. コードのデバッグ" accesskey="N">次へ</a></li>
        <li class="right">
          <a href="http://www.turbare.net/transl/scipy-lecture-notes/advanced/advanced_python/index.html" title="2.1. Python の先進的機能を構成するもの" accesskey="P">前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="http://www.turbare.net/transl/scipy-lecture-notes/index.html">Scipy lecture notes</a> »</li>
          <li class="nav-item nav-item-1"><a href="http://www.turbare.net/transl/scipy-lecture-notes/advanced/index.html" accesskey="U">2. 先進的な話題</a> »</li>
     
    <!-- Insert a menu in the navigation bar -->
    <li class="left">
	<!-- On click toggle the 'tip' on or off-->
	<a onclick="$('.tip').each(function (index, obj) {
			    collapse_tip_div(obj);
		    });
		    $('.tip').addClass('collapsed');
		    $('.left').addClass('transparent');">
	<img src="2.2.%20Numpy%20%E3%81%AE%E5%85%88%E9%80%B2%E7%9A%84%E3%81%AA%E6%A9%9F%E8%83%BD%20%E2%80%94%20Scipy%20lecture%20notes_files/minus.png" alt="Collapse to compact view" style="padding: 1ex;">
	<span class="hiddenlink">Collapse document to compact view</span>
    </a></li>
    <li class="right edit_on_github"><a href="https://github.com/scipy-lectures/scipy-lecture-notes/edit/master/advanced/advanced_numpy/index.rst">Edit
    <span class="tooltip">
	Improve this page:<br>Edit it on Github.
    </span>
    </a>
    </li>

      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body active" role="main">
            
  <div class="section" id="advanced-numpy">
<span id="id1"></span><h1>2.2. Numpy の先進的な機能<a class="headerlink" href="#advanced-numpy" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p><strong>著者</strong>: <em>Pauli Virtanen</em></p>
<p>Numpy は Python による科学技術計算ツールスタックの基本で、メモリブロック内のたくさんの要素の効率的な操作を実装するために利用されます。その詳細を知ることで、柔軟性を活かして効率的に利用し、便利に近道することができます。</p>
<p>この節で扱う内容:</p>
<ul class="simple">
<li><p class="first">Numpy 配列の詳細とその成果物、Tips や工夫。</p>
</li>
<li><p class="first">ユニバーサル関数: どんなもので、なぜあるのか、そして新しく欲しくなったときにどうすればいいか。</p>
</li>
<li><p class="first">他のツールとの統合: Numpy はいくつかの方法で ndarray の中の任意のデータを不要なコピーなしに、ラップすることができます。</p>
</li>
<li><p class="first">最近追加された機能とそれが何をもたらすか: PEP 3118 buffers, generalised ufuncs, ...</p>
</li>
</ul>
<div class="topic">
<p class="topic-title first">事前準備</p>
<ul class="simple">
<li>Numpy</li>
<li>Cython</li>
<li><p class="first">Pillow (Python の画像処理ライブラリ、いくつかの例の中で利用)</p>
</li>
</ul>
</div>
<div class="contents local topic active" id="chapter-contents">
<p class="topic-title first">章の内容</p>
<ul class="simple">
<li class="active"><a class="reference internal" href="#life-of-ndarray" id="id4">ndarray の生態</a><ul>
<li class=""><a class="reference internal" href="#it-s" id="id5">ndarray とは...</a></li>
<li class=""><a class="reference internal" href="#block-of-memory" id="id6">メモリブロック</a></li>
<li class="active"><a class="reference internal" href="#data-types" id="id7">データ型</a></li>
<li><a class="reference internal" href="#indexing-scheme-strides" id="id8">インデクス方式: ストライド</a></li>
<li><a class="reference internal" href="#findings-in-dissection" id="id9">解剖により得た知見</a></li>
</ul>
</li>
<li><a class="reference internal" href="#universal-functions" id="id10">ユニバーサル関数</a><ul>
<li><a class="reference internal" href="#what-they-are" id="id11">とは何か?</a></li>
<li><a class="reference internal" href="#exercise-building-an-ufunc-from-scratch" id="id12">演習: ufunc をスクラッチから作る</a></li>
<li><a class="reference internal" href="#solution-building-an-ufunc-from-scratch" id="id13">解答: スクラッチから ufunc を作る</a></li>
<li><a class="reference internal" href="#generalized-ufuncs" id="id14">一般化された ufunc</a></li>
</ul>
</li>
<li><a class="reference internal" href="#interoperability-features" id="id15">相互運用のための機能</a><ul>
<li><a class="reference internal" href="#sharing-multidimensional-typed-data" id="id16">多次元の型つきデータを共有する</a></li>
<li><a class="reference internal" href="#the-old-buffer-protocol" id="id17">古い buffer プロトコル</a></li>
<li><a class="reference internal" href="#id3" id="id18">古い buffer プロトコル</a></li>
<li><a class="reference internal" href="#array-interface-protocol" id="id19">Array インターフェースプロトコル</a></li>
</ul>
</li>
<li><a class="reference internal" href="#array-siblings-chararray-maskedarray-matrix" id="id20">配列の競合: <code class="xref py py-class docutils literal"><span class="pre">chararray</span></code>, <code class="xref py py-class docutils literal"><span class="pre">maskedarray</span></code>, <code class="xref py py-class docutils literal"><span class="pre">matrix</span></code></a><ul>
<li><a class="reference internal" href="#chararray-vectorized-string-operations" id="id21"><code class="xref py py-class docutils literal"><span class="pre">chararray</span></code>: 文字列演算のベクトル化</a></li>
<li><a class="reference internal" href="#masked-array-missing-data" id="id22"><code class="xref py py-class docutils literal"><span class="pre">masked_array</span></code> 欠損データ</a></li>
<li><a class="reference internal" href="#recarray-purely-convenience" id="id23"><code class="xref py py-class docutils literal"><span class="pre">recarray</span></code>: 純粋に便利</a></li>
<li><a class="reference internal" href="#matrix-convenience" id="id24"><code class="xref py py-class docutils literal"><span class="pre">matrix</span></code>: は便利なの?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#summary" id="id25">まとめ</a></li>
<li><a class="reference internal" href="#contributing-to-numpy-scipy" id="id26">Numpy/Scipy に貢献するには</a><ul>
<li><a class="reference internal" href="#why" id="id27">なぜ</a></li>
<li><a class="reference internal" href="#reporting-bugs" id="id28">バグレポート</a></li>
<li><a class="reference internal" href="#contributing-to-documentation" id="id29">ドキュメントへの貢献</a></li>
<li><a class="reference internal" href="#contributing-features" id="id30">機能の貢献</a></li>
<li><a class="reference internal" href="#how-to-help-in-general" id="id31">一般的な支援をするには</a></li>
</ul>
</li>
</ul>
</div>
<div class="admonition tip">
<p class="first admonition-title">ちなみに</p>
<p>この章では numpy は以下のようにしてインポートされます:</p>
<div style="position: relative;" class="last highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<div class="newline"></div></pre></div>
</div>
</div>
<div class="section" id="life-of-ndarray">
<h2><a class="toc-backref" href="#id4">2.2.1. ndarray の生態</a><a class="headerlink" href="#life-of-ndarray" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="it-s">
<h3><a class="toc-backref" href="#id5">2.2.1.1. ndarray とは...</a><a class="headerlink" href="#it-s" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><strong>ndarray</strong> =</p>
<blockquote>
<div><p>メモリブロック + インデクス方式 + データ型デスクリプタ</p>
<ul class="simple">
<li><p class="first">生のデータ</p>
</li>
<li><p class="first">要素がどう配置されているか</p>
</li>
<li><p class="first">要素をどう解釈するか</p>
</li>
</ul>
</div></blockquote>
<img alt="../../_images/threefundamental.png" src="2.2.%20Numpy%20%E3%81%AE%E5%85%88%E9%80%B2%E7%9A%84%E3%81%AA%E6%A9%9F%E8%83%BD%20%E2%80%94%20Scipy%20lecture%20notes_files/threefundamental.png">
<div class="highlight-c"><div class="highlight"><pre><span class="k">typedef</span> <span class="k">struct</span> <span class="n">PyArrayObject</span> <span class="p">{</span>
<div class="newline"></div>        <span class="n">PyObject_HEAD</span>
<div class="newline"></div>
<div class="newline"></div>        <span class="cm">/* Block of memory */</span>
<div class="newline"></div>        <span class="kt">char</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>
<div class="newline"></div>
<div class="newline"></div>        <span class="cm">/* Data type descriptor */</span>
<div class="newline"></div>        <span class="n">PyArray_Descr</span> <span class="o">*</span><span class="n">descr</span><span class="p">;</span>
<div class="newline"></div>
<div class="newline"></div>        <span class="cm">/* Indexing scheme */</span>
<div class="newline"></div>        <span class="kt">int</span> <span class="n">nd</span><span class="p">;</span>
<div class="newline"></div>        <span class="n">npy_intp</span> <span class="o">*</span><span class="n">dimensions</span><span class="p">;</span>
<div class="newline"></div>        <span class="n">npy_intp</span> <span class="o">*</span><span class="n">strides</span><span class="p">;</span>
<div class="newline"></div>
<div class="newline"></div>        <span class="cm">/* Other stuff */</span>
<div class="newline"></div>        <span class="n">PyObject</span> <span class="o">*</span><span class="n">base</span><span class="p">;</span>
<div class="newline"></div>        <span class="kt">int</span> <span class="n">flags</span><span class="p">;</span>
<div class="newline"></div>        <span class="n">PyObject</span> <span class="o">*</span><span class="n">weakreflist</span><span class="p">;</span>
<div class="newline"></div><span class="p">}</span> <span class="n">PyArrayObject</span><span class="p">;</span>
<div class="newline"></div></pre></div>
</div>
</div>
<div class="section" id="block-of-memory">
<h3><a class="toc-backref" href="#id6">2.2.1.2. メモリブロック</a><a class="headerlink" href="#block-of-memory" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">data</span>      
<div class="newline"></div><span class="go">&lt;... at ...&gt;</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>  
<div class="newline"></div><span class="go">'\x01\x00\x00\x00\x02\x00\x00\x00\x03\x00\x00\x00'</span>
<div class="newline"></div></pre></div>
</div>
<p>データのメモリアドレス</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">__array_interface__</span><span class="p">[</span><span class="s">'data'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 
<div class="newline"></div><span class="go">64803824</span>
<div class="newline"></div></pre></div>
</div>
<p><code class="docutils literal"><span class="pre">__array_interface__</span></code> 全体:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">__array_interface__</span>  
<div class="newline"></div><span class="go">{'data': (35828928, False),</span>
<div class="newline"></div><span class="go"> 'descr': [('', '&lt;i4')],</span>
<div class="newline"></div><span class="go"> 'shape': (4,),</span>
<div class="newline"></div><span class="go"> 'strides': None,</span>
<div class="newline"></div><span class="go"> 'typestr': '&lt;i4',</span>
<div class="newline"></div><span class="go"> 'version': 3}</span>
<div class="newline"></div></pre></div>
</div>
<p>注意: 2つの <code class="xref py py-class docutils literal"><span class="pre">ndarrays</span></code> は同じメモリを共有しうる:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span>
<div class="newline"></div><span class="go">array([9, 2, 3])</span>
<div class="newline"></div></pre></div>
</div>
<p>メモリは <code class="xref py py-class docutils literal"><span class="pre">ndarray</span></code> によって所有される必要はありません:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">b</span><span class="s">'1234'</span>      <span class="c"># The 'b' is for "bytes", necessary in Python 3</span>
<div class="newline"></div></pre></div>
</div>
<p>x は string (Python 3 では bytes) で、整数配列として表現することもできます:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="o">.</span><span class="n">data</span>      
<div class="newline"></div><span class="go">&lt;... at ...&gt;</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="o">.</span><span class="n">base</span> <span class="ow">is</span> <span class="n">x</span>
<div class="newline"></div><span class="go">True</span>
<div class="newline"></div>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="o">.</span><span class="n">flags</span>
<div class="newline"></div><span class="go">  C_CONTIGUOUS : True</span>
<div class="newline"></div><span class="go">  F_CONTIGUOUS : True</span>
<div class="newline"></div><span class="go">  OWNDATA : False</span>
<div class="newline"></div><span class="go">  WRITEABLE : False</span>
<div class="newline"></div><span class="go">  ALIGNED : True</span>
<div class="newline"></div><span class="go">  UPDATEIFCOPY : False</span>
<div class="newline"></div></pre></div>
</div>
<p><code class="docutils literal"><span class="pre">owndata</span></code> と <code class="docutils literal"><span class="pre">writeable</span></code> フラグはメモリブロックの状態を示します。</p>
</div>
<div class="section" id="data-types">
<h3><a class="toc-backref" href="#id7">2.2.1.3. データ型</a><a class="headerlink" href="#data-types" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="the-descriptor">
<h4>2.2.1.3.1. デスクリプタ<a class="headerlink" href="#the-descriptor" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p><code class="xref py py-class docutils literal"><span class="pre">dtype</span></code> は配列の1つの要素の性質を記述します:</p>
<table class="docutils" border="1">
<colgroup>
<col width="10%">
<col width="90%">
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>type</td>
<td><p class="first">データの <strong>スカラー型</strong> で以下の内のどれか:</p>
<p>int8, int16, float64, <em>など</em>  (固定サイズ)</p>
<p class="last">str, unicode, void  (任意サイズ)</p>
</td>
</tr>
<tr class="row-even"><td>itemsize</td>
<td><p class="first last">データブロックの <strong>サイズ</strong></p>
</td>
</tr>
<tr class="row-odd"><td>byteorder</td>
<td><p class="first last"><strong>バイトオーダー</strong>: ビッグエンディアン <code class="docutils literal"><span class="pre">&gt;</span></code> / リトルエンディアン <code class="docutils literal"><span class="pre">&lt;</span></code> / 適用不可 <code class="docutils literal"><span class="pre">|</span></code></p>
</td>
</tr>
<tr class="row-even"><td>fields</td>
<td><p class="first last">サブ dtype <em>構造化されたデータ型</em> の場合</p>
</td>
</tr>
<tr class="row-odd"><td>shape</td>
<td><p class="first last">配列のシェイプ、 <strong>サブ配列</strong> の場合</p>
</td>
</tr>
</tbody>
</table>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">type</span>      
<div class="newline"></div><span class="go">&lt;type 'numpy.int64'&gt;</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">itemsize</span>
<div class="newline"></div><span class="go">8</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">byteorder</span>
<div class="newline"></div><span class="go">'='</span>
<div class="newline"></div></pre></div>
</div>
</div>
<div class="section" id="example-reading-wav-files">
<h4>2.2.1.3.2. 例: <code class="docutils literal"><span class="pre">.wav</span></code> ファイルの読み込み<a class="headerlink" href="#example-reading-wav-files" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p><code class="docutils literal"><span class="pre">.wav</span></code> ファイルのヘッダ:</p>
<table class="docutils" border="1">
<colgroup>
<col width="28%">
<col width="72%">
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>chunk_id</td>
<td><code class="docutils literal"><span class="pre">"RIFF"</span></code></td>
</tr>
<tr class="row-even"><td>chunk_size</td>
<td><p class="first last">4バイトの符号無しリトルエンディアン整数</p>
</td>
</tr>
<tr class="row-odd"><td>format</td>
<td><code class="docutils literal"><span class="pre">"WAVE"</span></code></td>
</tr>
<tr class="row-even"><td>fmt_id</td>
<td><code class="docutils literal"><span class="pre">"fmt</span> <span class="pre">"</span></code></td>
</tr>
<tr class="row-odd"><td>fmt_size</td>
<td><p class="first last">4バイトの符号無しリトルエンディアン整数</p>
</td>
</tr>
<tr class="row-even"><td>audio_fmt</td>
<td><p class="first last">2バイトの符号無しリトルエンディアン整数</p>
</td>
</tr>
<tr class="row-odd"><td>num_channels</td>
<td><p class="first last">2バイトの符号無しリトルエンディアン整数</p>
</td>
</tr>
<tr class="row-even"><td>sample_rate</td>
<td><p class="first last">4バイトの符号無しリトルエンディアン整数</p>
</td>
</tr>
<tr class="row-odd"><td>byte_rate</td>
<td><p class="first last">4バイトの符号無しリトルエンディアン整数</p>
</td>
</tr>
<tr class="row-even"><td>block_align</td>
<td><p class="first last">2バイトの符号無しリトルエンディアン整数</p>
</td>
</tr>
<tr class="row-odd"><td>bits_per_sample</td>
<td><p class="first last">2バイトの符号無しリトルエンディアン整数</p>
</td>
</tr>
<tr class="row-even"><td>data_id</td>
<td><code class="docutils literal"><span class="pre">"data"</span></code></td>
</tr>
<tr class="row-odd"><td>data_size</td>
<td><p class="first last">4バイトの符号無しリトルエンディアン整数</p>
</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p class="first">生データの(ファイル先頭の)44バイトブロック</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">data_size</span></code> のバイトの後に実際の音データが続く。</p>
</li>
</ul>
<p><code class="docutils literal"><span class="pre">.wav</span></code> ファイルヘッダを Numpy の <em>構造化された</em> データ型にしてみると:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">wav_header_dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">([</span>
<div class="newline"></div><span class="gp">... </span>    <span class="p">(</span><span class="s">"chunk_id"</span><span class="p">,</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span> <span class="c"># flexible-sized scalar type, item size 4</span>
<div class="newline"></div><span class="gp">... </span>    <span class="p">(</span><span class="s">"chunk_size"</span><span class="p">,</span> <span class="s">"&lt;u4"</span><span class="p">),</span>    <span class="c"># little-endian unsigned 32-bit integer</span>
<div class="newline"></div><span class="gp">... </span>    <span class="p">(</span><span class="s">"format"</span><span class="p">,</span> <span class="s">"S4"</span><span class="p">),</span>         <span class="c"># 4-byte string</span>
<div class="newline"></div><span class="gp">... </span>    <span class="p">(</span><span class="s">"fmt_id"</span><span class="p">,</span> <span class="s">"S4"</span><span class="p">),</span>
<div class="newline"></div><span class="gp">... </span>    <span class="p">(</span><span class="s">"fmt_size"</span><span class="p">,</span> <span class="s">"&lt;u4"</span><span class="p">),</span>
<div class="newline"></div><span class="gp">... </span>    <span class="p">(</span><span class="s">"audio_fmt"</span><span class="p">,</span> <span class="s">"&lt;u2"</span><span class="p">),</span>     <span class="c">#</span>
<div class="newline"></div><span class="gp">... </span>    <span class="p">(</span><span class="s">"num_channels"</span><span class="p">,</span> <span class="s">"&lt;u2"</span><span class="p">),</span>  <span class="c"># .. more of the same ...</span>
<div class="newline"></div><span class="gp">... </span>    <span class="p">(</span><span class="s">"sample_rate"</span><span class="p">,</span> <span class="s">"&lt;u4"</span><span class="p">),</span>   <span class="c">#</span>
<div class="newline"></div><span class="gp">... </span>    <span class="p">(</span><span class="s">"byte_rate"</span><span class="p">,</span> <span class="s">"&lt;u4"</span><span class="p">),</span>
<div class="newline"></div><span class="gp">... </span>    <span class="p">(</span><span class="s">"block_align"</span><span class="p">,</span> <span class="s">"&lt;u2"</span><span class="p">),</span>
<div class="newline"></div><span class="gp">... </span>    <span class="p">(</span><span class="s">"bits_per_sample"</span><span class="p">,</span> <span class="s">"&lt;u2"</span><span class="p">),</span>
<div class="newline"></div><span class="gp">... </span>    <span class="p">(</span><span class="s">"data_id"</span><span class="p">,</span> <span class="p">(</span><span class="s">"S1"</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))),</span> <span class="c"># sub-array, just for fun!</span>
<div class="newline"></div><span class="gp">... </span>    <span class="p">(</span><span class="s">"data_size"</span><span class="p">,</span> <span class="s">"u4"</span><span class="p">),</span>
<div class="newline"></div><span class="gp">... </span>    <span class="c">#</span>
<div class="newline"></div><span class="gp">... </span>    <span class="c"># the sound data itself cannot be represented here:</span>
<div class="newline"></div><span class="gp">... </span>    <span class="c"># it does not have a fixed size</span>
<div class="newline"></div><span class="gp">... </span>   <span class="p">])</span>
<div class="newline"></div></pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last">wavreader.py</p>
</div>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">wav_header_dtype</span><span class="p">[</span><span class="s">'format'</span><span class="p">]</span>
<div class="newline"></div><span class="go">dtype('S4')</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">wav_header_dtype</span><span class="o">.</span><span class="n">fields</span>     
<div class="newline"></div><span class="go">dict_proxy({'block_align': (dtype('uint16'), 32), 'format': (dtype('S4'), 8), 'data_id': (dtype(('S1', (2, 2))), 36), 'fmt_id': (dtype('S4'), 12), 'byte_rate': (dtype('uint32'), 28), 'chunk_id': (dtype('S4'), 0), 'num_channels': (dtype('uint16'), 22), 'sample_rate': (dtype('uint32'), 24), 'bits_per_sample': (dtype('uint16'), 34), 'chunk_size': (dtype('uint32'), 4), 'fmt_size': (dtype('uint32'), 16), 'data_size': (dtype('uint32'), 40), 'audio_fmt': (dtype('uint16'), 20)})</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">wav_header_dtype</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s">'format'</span><span class="p">]</span>
<div class="newline"></div><span class="go">(dtype('S4'), 8)</span>
<div class="newline"></div></pre></div>
</div>
<ul class="simple">
<li><p class="first">最初の要素は <code class="docutils literal"><span class="pre">format</span></code> の名の通り、構造化されたデータの サブ dtype です。</p>
</li>
<li><p class="first">2つめは要素の先頭からのオフセット(バイト単位)です。</p>
</li>
</ul>
<div class="green topic">
<p class="topic-title first">練習問題</p>
<p>小演習として offsets を利用し、フィールドにいくつかの値だけを使うことで “sparse” dtype を作成しましょう:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">wav_header_dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
<div class="newline"></div><span class="gp">... </span>  <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s">'format'</span><span class="p">,</span> <span class="s">'sample_rate'</span><span class="p">,</span> <span class="s">'data_id'</span><span class="p">],</span>
<div class="newline"></div><span class="gp">... </span>  <span class="n">offsets</span><span class="o">=</span><span class="p">[</span><span class="n">offset_1</span><span class="p">,</span> <span class="n">offset_2</span><span class="p">,</span> <span class="n">offset_3</span><span class="p">],</span> <span class="c"># counted from start of structure in bytes</span>
<div class="newline"></div><span class="gp">... </span>  <span class="n">formats</span><span class="o">=</span><span class="nb">list</span> <span class="n">of</span> <span class="n">dtypes</span> <span class="k">for</span> <span class="n">each</span> <span class="n">of</span> <span class="n">the</span> <span class="n">fields</span><span class="p">,</span>
<div class="newline"></div><span class="gp">... </span><span class="p">))</span>  
<div class="newline"></div></pre></div>
</div>
<p>それを使って、サンプルレートと <code class="docutils literal"><span class="pre">data_id</span></code> (サブ配列として) を読み出しましょう。</p>
</div>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'data/test.wav'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">wav_header</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">wav_header_dtype</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">wav_header</span><span class="p">)</span>   
<div class="newline"></div><span class="go">[ ('RIFF', 17402L, 'WAVE', 'fmt ', 16L, 1, 1, 16000L, 32000L, 2, 16, [['d', 'a'], ['t', 'a']], 17366L)]</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">wav_header</span><span class="p">[</span><span class="s">'sample_rate'</span><span class="p">]</span>
<div class="newline"></div><span class="go">array([16000], dtype=uint32)</span>
<div class="newline"></div></pre></div>
</div>
<p>サブ配列にアクセスしてみましょう:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">wav_header</span><span class="p">[</span><span class="s">'data_id'</span><span class="p">]</span>  
<div class="newline"></div><span class="go">array([[['d', 'a'],</span>
<div class="newline"></div><span class="go">        ['t', 'a']]],</span>
<div class="newline"></div><span class="go">      dtype='|S1')</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">wav_header</span><span class="o">.</span><span class="n">shape</span>
<div class="newline"></div><span class="go">(1,)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">wav_header</span><span class="p">[</span><span class="s">'data_id'</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<div class="newline"></div><span class="go">(1, 2, 2)</span>
<div class="newline"></div></pre></div>
</div>
<p>サブ配列にアクセスするときには、次元が末尾に足されます!</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">音データを読み込むには <code class="docutils literal"><span class="pre">wavfile</span></code>, <code class="docutils literal"><span class="pre">audiolab</span></code> などの既存のモジュールがあります...</p>
</div>
</div>
<div class="section" id="casting-and-re-interpretation-views">
<h4>2.2.1.3.3. キャストと再解釈/ビュー<a class="headerlink" href="#casting-and-re-interpretation-views" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p><strong>キャスト</strong></p>
<blockquote>
<div><ul class="simple">
<li><p class="first">代入による</p>
</li>
<li><p class="first">配列作成による</p>
</li>
<li><p class="first">算術演算による</p>
</li>
<li><p class="first">など</p>
</li>
<li><p class="first">そして手動で: <code class="docutils literal"><span class="pre">.astype(dtype)</span></code></p>
</li>
</ul>
</div></blockquote>
<p><strong>データの再解釈</strong></p>
<blockquote>
<div><ul class="simple">
<li><p class="first">手動で: <code class="docutils literal"><span class="pre">.view(dtype)</span></code></p>
</li>
</ul>
</div></blockquote>
<div class="section" id="casting">
<h5>2.2.1.3.3.1. キャスト<a class="headerlink" href="#casting" title="このヘッドラインへのパーマリンク">¶</a></h5>
<ul>
<li><p class="first">算術によるキャストは、要約すると:</p>
<ul class="simple">
<li><p class="first">演算対象となる型(値ではなく!)が問題になる</p>
</li>
<li><p class="first">両者を表現するためにより広範で「安全」な型が採用される</p>
</li>
<li><p class="first">いくつかの状況でスカラーを配列にすると失われることがありますl</p>
</li>
</ul>
</li>
<li><p class="first">キャストでは一般的にデータがコピーされます:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>
<div class="newline"></div><span class="go">array([ 1.,  2.,  3.,  4.])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span>
<div class="newline"></div><span class="go">array([1, 2, 3, 4], dtype=int8)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span>
<div class="newline"></div><span class="go">array([2, 3, 4, 5], dtype=int8)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">+</span> <span class="mi">256</span>
<div class="newline"></div><span class="go">array([257, 258, 259, 260], dtype=int16)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">+</span> <span class="mf">256.0</span>
<div class="newline"></div><span class="go">array([ 257.,  258.,  259.,  260.])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">256</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<div class="newline"></div><span class="go">array([257, 258, 259, 260], dtype=int32)</span>
<div class="newline"></div></pre></div>
</div>
</li>
<li><p class="first">setitem の際のキャスト: 配列の dtype は要素の代入で変化しません:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="mf">1.5</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span>
<div class="newline"></div><span class="go">array([2, 3, 4, 5], dtype=int8)</span>
<div class="newline"></div></pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">厳密なルールについては: <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/ufuncs.html#casting-rules">numpy documentation</a> を参照してください</p>
</div>
</div>
<div class="section" id="re-interpretation-viewing">
<h5>2.2.1.3.3.2. 再解釈 / ビュー<a class="headerlink" href="#re-interpretation-viewing" title="このヘッドラインへのパーマリンク">¶</a></h5>
<ul>
<li><p class="first">メモリ上のデータブロック (4バイト)</p>
<table class="docutils" border="1">
<colgroup>
<col width="19%">
<col width="8%">
<col width="19%">
<col width="8%">
<col width="19%">
<col width="8%">
<col width="19%">
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">0x01</span></code></td>
<td>||</td>
<td><code class="docutils literal"><span class="pre">0x02</span></code></td>
<td>||</td>
<td><code class="docutils literal"><span class="pre">0x03</span></code></td>
<td>||</td>
<td><code class="docutils literal"><span class="pre">0x04</span></code></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p class="first">unit8 が4つ、または</p>
</li>
<li><p class="first">int8 が4つ、または</p>
</li>
<li><p class="first">int16 が2つ、または</p>
</li>
<li><p class="first">int32 が1つ、または</p>
</li>
<li><p class="first">float32 が1つ、または</p>
</li>
<li>...</li>
</ul>
<p>どうすれば、これらを別のものに切り替えられるでしょうか?</p>
</li>
</ul>
<ol class="arabic">
<li><p class="first">dtype の切り替え:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="s">"&lt;i2"</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>
<div class="newline"></div><span class="go">array([ 513, 1027], dtype=int16)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="mh">0x0201</span><span class="p">,</span> <span class="mh">0x0403</span>
<div class="newline"></div><span class="go">(513, 1027)</span>
<div class="newline"></div></pre></div>
</div>
</li>
</ol>
<blockquote>
<div><table class="docutils" border="1">
<colgroup>
<col width="23%">
<col width="23%">
<col width="9%">
<col width="23%">
<col width="23%">
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">0x01</span></code></td>
<td><code class="docutils literal"><span class="pre">0x02</span></code></td>
<td>||</td>
<td><code class="docutils literal"><span class="pre">0x03</span></code></td>
<td><code class="docutils literal"><span class="pre">0x04</span></code></td>
</tr>
</tbody>
</table>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">リトルエンディアン: 最下位バイトがメモリの <em>左</em> になる</p>
</div>
</div></blockquote>
</div></blockquote>
<ol class="arabic" start="2">
<li><p class="first">新しいビューを作る</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s">"&lt;i4"</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span>
<div class="newline"></div><span class="go">array([67305985], dtype=int32)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="mh">0x04030201</span>
<div class="newline"></div><span class="go">67305985</span>
<div class="newline"></div></pre></div>
</div>
</li>
</ol>
<blockquote>
<div><table class="docutils" border="1">
<colgroup>
<col width="25%">
<col width="25%">
<col width="25%">
<col width="25%">
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">0x01</span></code></td>
<td><code class="docutils literal"><span class="pre">0x02</span></code></td>
<td><code class="docutils literal"><span class="pre">0x03</span></code></td>
<td><code class="docutils literal"><span class="pre">0x04</span></code></td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<ul class="last">
<li><p class="first"><code class="docutils literal"><span class="pre">.view()</span></code> は <em>ビュー</em> を作り、メモリブロックをコピー(あるいは変更)しません</p>
</li>
<li><p class="first">dtype の変更 (そして配列のシェイプ調整) のみします:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span>
<div class="newline"></div><span class="go">array([328193], dtype=int32)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="o">.</span><span class="n">base</span> <span class="ow">is</span> <span class="n">x</span>
<div class="newline"></div><span class="go">True</span>
<div class="newline"></div></pre></div>
</div>
</li>
</ul>
</div>
<p class="rubric">小演習: データ再解釈</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last">view-colors.py</p>
</div>
<p>配列内に RGBA データがあります:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<div class="newline"></div></pre></div>
</div>
<p>最後の3つの次元は R B G そしてアルファチャネルです。</p>
<p>フィールド <cite>r</cite>, <cite>g</cite>, <cite>b</cite>, <cite>a</cite> を持つ (10, 10) の構造化された配列を、データコピーなしで、作成するにはどうすればいいでしょうか?:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="o">...</span>                     
<div class="newline"></div>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="s">'r'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="s">'g'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="s">'b'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="s">'a'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  
<div class="newline"></div></pre></div>
</div>
<p><em>解答</em></p>
<blockquote>
<div><a onclick="$('#hidden-item-0').toggle(100)">...</a>
<div id="hidden-item-0" style="display: none;"><div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">([(</span><span class="s">'r'</span><span class="p">,</span> <span class="s">'i1'</span><span class="p">),</span>
<div class="newline"></div><span class="gp">... </span>            <span class="p">(</span><span class="s">'g'</span><span class="p">,</span> <span class="s">'i1'</span><span class="p">),</span>
<div class="newline"></div><span class="gp">... </span>            <span class="p">(</span><span class="s">'b'</span><span class="p">,</span> <span class="s">'i1'</span><span class="p">),</span>
<div class="newline"></div><span class="gp">... </span>            <span class="p">(</span><span class="s">'a'</span><span class="p">,</span> <span class="s">'i1'</span><span class="p">)]</span>
<div class="newline"></div><span class="gp">... </span>             <span class="p">)[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
<div class="newline"></div></pre></div>
</div>
</div></div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p>同じメモリ4バイトを持つ別の配列:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>
<div class="newline"></div><span class="go">array([[1, 2],</span>
<div class="newline"></div><span class="go">       [3, 4]], dtype=uint8)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span>
<div class="newline"></div><span class="go">array([[1, 2],</span>
<div class="newline"></div><span class="go">       [3, 4]], dtype=uint8)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
<div class="newline"></div><span class="go">array([[ 513],</span>
<div class="newline"></div><span class="go">       [1027]], dtype=int16)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="mh">0x0201</span><span class="p">,</span> <span class="mh">0x0403</span>
<div class="newline"></div><span class="go">(513, 1027)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
<div class="newline"></div><span class="go">array([[ 769, 1026]], dtype=int16)</span>
<div class="newline"></div></pre></div>
</div>
<ul class="simple">
<li><p class="first">何が起きたのでしょう?</p>
</li>
<li><p class="first">... <code class="docutils literal"><span class="pre">x[0,1]</span></code> が実際に示すものが何かを見てみる必要があります</p>
</li>
</ul>
<div style="position: relative;" class="last highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="mh">0x0301</span><span class="p">,</span> <span class="mh">0x0402</span>
<div class="newline"></div><span class="go">(769, 1026)</span>
<div class="newline"></div></pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="indexing-scheme-strides">
<h3><a class="toc-backref" href="#id8">2.2.1.4. インデクス方式: ストライド</a><a class="headerlink" href="#indexing-scheme-strides" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="main-point">
<h4>2.2.1.4.1. 主要な点<a class="headerlink" href="#main-point" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p><strong>質問</strong>:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
<div class="newline"></div><span class="gp">... </span>              <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
<div class="newline"></div><span class="gp">... </span>              <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>  
<div class="newline"></div><span class="go">'\x01\x02\x03\x04\x05\x06\x07\x08\t'</span>
<div class="newline"></div>
<div class="newline"></div><span class="go">At which byte in ``x.data`` does the item ``x[1, 2]`` begin?</span>
<div class="newline"></div></pre></div>
</div>
<p><strong>答</strong> (in Numpy)</p>
<blockquote>
<div><ul class="simple">
<li><p class="first"><strong>ストライド</strong>: 次の要素を見つけるためにジャンプするバイト数</p>
</li>
<li><p class="first">次元ごとに1つのストライド</p>
</li>
</ul>
</div></blockquote>
<div class="highlight-python"><div class="highlight"><pre>  <span class="o">&gt;&gt;&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">strides</span>
<div class="newline"></div>  <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<div class="newline"></div>  <span class="o">&gt;&gt;&gt;</span> <span class="n">byte_offset</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span><span class="o">*</span><span class="mi">2</span>   <span class="c"># to find x[1, 2]</span>
<div class="newline"></div>  <span class="o">&gt;&gt;&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">byte_offset</span><span class="p">]</span>
<div class="newline"></div>  <span class="mi">6</span>
<div class="newline"></div>  <span class="o">&gt;&gt;&gt;</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<div class="newline"></div>  <span class="mi">6</span>
<div class="newline"></div>
<div class="newline"></div><span class="o">-</span> <span class="n">simple</span><span class="p">,</span> <span class="o">**</span><span class="n">flexible</span><span class="o">**</span>
<div class="newline"></div></pre></div>
</div>
<div class="section" id="c-and-fortran-order">
<h5>2.2.1.4.1.1. C の順序と Fortran の順序<a class="headerlink" href="#c-and-fortran-order" title="このヘッドラインへのパーマリンク">¶</a></h5>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
<div class="newline"></div><span class="gp">... </span>              <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s">'C'</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">strides</span>
<div class="newline"></div><span class="go">(6, 2)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>  
<div class="newline"></div><span class="go">'\x01\x00\x02\x00\x03\x00\x04\x00\x05\x00\x06\x00'</span>
<div class="newline"></div></pre></div>
</div>
<ul class="simple">
<li><p class="first">次の列を見つけるために6バイトのジャンプが必要</p>
</li>
<li><p class="first">次の行を見つけるために2バイトのジャンプが必要</p>
</li>
</ul>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s">'F'</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="o">.</span><span class="n">strides</span>
<div class="newline"></div><span class="go">(2, 4)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>  
<div class="newline"></div><span class="go">'\x01\x00\x04\x00\x02\x00\x05\x00\x03\x00\x06\x00'</span>
<div class="newline"></div></pre></div>
</div>
<ul class="simple">
<li><p class="first">次の列を見つけるために2バイトのジャンプが必要</p>
</li>
<li><p class="first">次の行を見つけるために4バイトのジャンプが必要</p>
</li>
</ul>
<ul>
<li><p class="first">高次元でも同様:</p>
<ul class="simple">
<li><p class="first">C: 最後の次元が最も速く変化する(=つまりストライドが小さい)</p>
</li>
<li><p class="first">F: 最初の次元が最も速く変化する</p>
</li>
</ul>
<div class="math">
<span style="color: inherit; display: none;" class="MathJax_Preview"></span><div style="text-align: center;" class="MathJax_Display"><span role="presentation" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable columnalign=&quot;right left&quot; rowspacing=&quot;3pt&quot; columnspacing=&quot;0em&quot; displaystyle=&quot;true&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;s&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;h&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;p&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;s&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;r&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;i&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;d&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;e&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msubsup&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;/msubsup&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;i&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;e&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;m&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;s&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;i&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;z&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msubsup&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mi&gt;F&lt;/mi&gt;&lt;/msubsup&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;i&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;e&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;m&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;s&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;i&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;z&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" style="text-align: center; position: relative;" tabindex="0" id="MathJax-Element-1-Frame" class="MathJax"><nobr aria-hidden="true"><span style="width: 18.609em; display: inline-block;" id="MathJax-Span-1" class="math"><span style="display: inline-block; position: relative; width: 14.183em; height: 0px; font-size: 131%;"><span style="position: absolute; clip: rect(-1.116em, 1014em, 4.693em, -1000em); top: -2.039em; left: 0em;"><span id="MathJax-Span-2" class="mrow"><span style="padding-right: 0.167em; padding-left: 0.167em;" id="MathJax-Span-3" class="mtable"><span style="display: inline-block; position: relative; width: 13.862em; height: 0px;"><span style="position: absolute; clip: rect(3.381em, 1002.57em, 9.074em, -1000em); top: -6.419em; left: 0em;"><span style="display: inline-block; position: relative; width: 2.614em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1002.26em, 4.337em, -1000em); top: -6.215em; right: 0em;"><span id="MathJax-Span-4" class="mtd"><span id="MathJax-Span-5" class="mrow"><span id="MathJax-Span-6" class="texatom"><span id="MathJax-Span-7" class="mrow"><span style="font-family: STIXGeneral;" id="MathJax-Span-8" class="mi">s</span><span style="font-family: STIXGeneral;" id="MathJax-Span-9" class="mi">h</span><span style="font-family: STIXGeneral;" id="MathJax-Span-10" class="mi">a</span><span style="font-family: STIXGeneral;" id="MathJax-Span-11" class="mi">p</span><span style="font-family: STIXGeneral;" id="MathJax-Span-12" class="mi">e</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span><span style="position: absolute; clip: rect(3.177em, 1002.57em, 4.13em, -1000em); top: -4.861em; right: 0em;"><span id="MathJax-Span-34" class="mtd"><span id="MathJax-Span-35" class="mrow"><span id="MathJax-Span-36" class="texatom"><span id="MathJax-Span-37" class="mrow"><span style="font-family: STIXGeneral;" id="MathJax-Span-38" class="mi">s</span><span style="font-family: STIXGeneral;" id="MathJax-Span-39" class="mi">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span style="font-family: STIXGeneral;" id="MathJax-Span-40" class="mi">r<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="font-family: STIXGeneral;" id="MathJax-Span-41" class="mi">i</span><span style="font-family: STIXGeneral;" id="MathJax-Span-42" class="mi">d</span><span style="font-family: STIXGeneral;" id="MathJax-Span-43" class="mi">e</span><span style="font-family: STIXGeneral;" id="MathJax-Span-44" class="mi">s</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span><span style="position: absolute; clip: rect(3.032em, 1000.95em, 4.563em, -1000em); top: -3.495em; right: 0em;"><span id="MathJax-Span-66" class="mtd"><span id="MathJax-Span-67" class="mrow"><span id="MathJax-Span-68" class="msubsup"><span style="display: inline-block; position: relative; width: 0.951em; height: 0px;"><span style="position: absolute; clip: rect(3.418em, 1000.37em, 4.133em, -1000em); top: -3.99em; left: 0em;"><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-69" class="mi">s</span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span><span style="position: absolute; clip: rect(3.389em, 1000.56em, 4.133em, -1000em); top: -4.347em; left: 0.389em;"><span style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-70" class="mi">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span><span style="position: absolute; clip: rect(3.399em, 1000.27em, 4.267em, -1000em); top: -3.694em; left: 0.389em;"><span style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-71" class="mi">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span><span style="position: absolute; clip: rect(3.054em, 1000.92em, 4.563em, -1000em); top: -1.908em; right: 0em;"><span id="MathJax-Span-109" class="mtd"><span id="MathJax-Span-110" class="mrow"><span id="MathJax-Span-111" class="msubsup"><span style="display: inline-block; position: relative; width: 0.92em; height: 0px;"><span style="position: absolute; clip: rect(3.418em, 1000.37em, 4.133em, -1000em); top: -3.99em; left: 0em;"><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-112" class="mi">s</span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span><span style="position: absolute; clip: rect(3.398em, 1000.53em, 4.12em, -1000em); top: -4.335em; left: 0.389em;"><span style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-113" class="mi">F<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.024em;"></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span><span style="position: absolute; clip: rect(3.399em, 1000.27em, 4.267em, -1000em); top: -3.694em; left: 0.389em;"><span style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-114" class="mi">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span></span><span style="display: inline-block; width: 0px; height: 6.419em;"></span></span><span style="position: absolute; clip: rect(3.251em, 1011.23em, 8.797em, -1000em); top: -6.289em; left: 2.614em;"><span style="display: inline-block; position: relative; width: 11.248em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1007.34em, 4.297em, -1000em); top: -6.215em; left: 0em;"><span id="MathJax-Span-13" class="mtd"><span id="MathJax-Span-14" class="mrow"><span id="MathJax-Span-15" class="mi"></span><span style="font-family: STIXGeneral; padding-left: 0.313em;" id="MathJax-Span-16" class="mo">=</span><span style="font-family: STIXGeneral; padding-left: 0.313em;" id="MathJax-Span-17" class="mo">(</span><span id="MathJax-Span-18" class="msubsup"><span style="display: inline-block; position: relative; width: 0.929em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.53em, 4.133em, -1000em); top: -3.99em; left: 0em;"><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-19" class="mi">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;"></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.5em;"><span style="font-size: 70.7%; font-family: STIXGeneral;" id="MathJax-Span-20" class="mn">1</span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span></span></span><span style="font-family: STIXGeneral;" id="MathJax-Span-21" class="mo">,</span><span style="padding-left: 0.188em;" id="MathJax-Span-22" class="msubsup"><span style="display: inline-block; position: relative; width: 0.929em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.53em, 4.133em, -1000em); top: -3.99em; left: 0em;"><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-23" class="mi">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;"></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.5em;"><span style="font-size: 70.7%; font-family: STIXGeneral;" id="MathJax-Span-24" class="mn">2</span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span></span></span><span style="font-family: STIXGeneral;" id="MathJax-Span-25" class="mo">,</span><span style="font-family: STIXGeneral; padding-left: 0.188em;" id="MathJax-Span-26" class="mo">.</span><span style="font-family: STIXGeneral; padding-left: 0.188em;" id="MathJax-Span-27" class="mo">.</span><span style="font-family: STIXGeneral; padding-left: 0.188em;" id="MathJax-Span-28" class="mo">.</span><span style="font-family: STIXGeneral; padding-left: 0.188em;" id="MathJax-Span-29" class="mo">,</span><span style="padding-left: 0.188em;" id="MathJax-Span-30" class="msubsup"><span style="display: inline-block; position: relative; width: 0.929em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.53em, 4.133em, -1000em); top: -3.99em; left: 0em;"><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-31" class="mi">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;"></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.5em;"><span style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-32" class="mi">n</span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span></span></span><span style="font-family: STIXGeneral;" id="MathJax-Span-33" class="mo">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span><span style="position: absolute; clip: rect(3.184em, 1007.01em, 4.297em, -1000em); top: -4.861em; left: 0em;"><span id="MathJax-Span-45" class="mtd"><span id="MathJax-Span-46" class="mrow"><span id="MathJax-Span-47" class="mi"></span><span style="font-family: STIXGeneral; padding-left: 0.313em;" id="MathJax-Span-48" class="mo">=</span><span style="font-family: STIXGeneral; padding-left: 0.313em;" id="MathJax-Span-49" class="mo">(</span><span id="MathJax-Span-50" class="msubsup"><span style="display: inline-block; position: relative; width: 0.818em; height: 0px;"><span style="position: absolute; clip: rect(3.418em, 1000.37em, 4.133em, -1000em); top: -3.99em; left: 0em;"><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-51" class="mi">s</span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.389em;"><span style="font-size: 70.7%; font-family: STIXGeneral;" id="MathJax-Span-52" class="mn">1</span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span></span></span><span style="font-family: STIXGeneral;" id="MathJax-Span-53" class="mo">,</span><span style="padding-left: 0.188em;" id="MathJax-Span-54" class="msubsup"><span style="display: inline-block; position: relative; width: 0.818em; height: 0px;"><span style="position: absolute; clip: rect(3.418em, 1000.37em, 4.133em, -1000em); top: -3.99em; left: 0em;"><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-55" class="mi">s</span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.389em;"><span style="font-size: 70.7%; font-family: STIXGeneral;" id="MathJax-Span-56" class="mn">2</span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span></span></span><span style="font-family: STIXGeneral;" id="MathJax-Span-57" class="mo">,</span><span style="font-family: STIXGeneral; padding-left: 0.188em;" id="MathJax-Span-58" class="mo">.</span><span style="font-family: STIXGeneral; padding-left: 0.188em;" id="MathJax-Span-59" class="mo">.</span><span style="font-family: STIXGeneral; padding-left: 0.188em;" id="MathJax-Span-60" class="mo">.</span><span style="font-family: STIXGeneral; padding-left: 0.188em;" id="MathJax-Span-61" class="mo">,</span><span style="padding-left: 0.188em;" id="MathJax-Span-62" class="msubsup"><span style="display: inline-block; position: relative; width: 0.818em; height: 0px;"><span style="position: absolute; clip: rect(3.418em, 1000.37em, 4.133em, -1000em); top: -3.99em; left: 0em;"><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-63" class="mi">s</span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.389em;"><span style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-64" class="mi">n</span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span></span></span><span style="font-family: STIXGeneral;" id="MathJax-Span-65" class="mo">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span><span style="position: absolute; clip: rect(3.177em, 1011.23em, 4.417em, -1000em); top: -3.495em; left: 0em;"><span id="MathJax-Span-72" class="mtd"><span id="MathJax-Span-73" class="mrow"><span id="MathJax-Span-74" class="mi"></span><span style="font-family: STIXGeneral; padding-left: 0.313em;" id="MathJax-Span-75" class="mo">=</span><span style="padding-left: 0.313em;" id="MathJax-Span-76" class="msubsup"><span style="display: inline-block; position: relative; width: 1.61em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.53em, 4.133em, -1000em); top: -3.99em; left: 0em;"><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-77" class="mi">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;"></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.5em;"><span id="MathJax-Span-78" class="texatom"><span id="MathJax-Span-79" class="mrow"><span style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-80" class="mi">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span style="font-size: 70.7%; font-family: STIXGeneral;" id="MathJax-Span-81" class="mo">+</span><span style="font-size: 70.7%; font-family: STIXGeneral;" id="MathJax-Span-82" class="mn">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span></span></span><span id="MathJax-Span-83" class="msubsup"><span style="display: inline-block; position: relative; width: 1.61em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.53em, 4.133em, -1000em); top: -3.99em; left: 0em;"><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-84" class="mi">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;"></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.5em;"><span id="MathJax-Span-85" class="texatom"><span id="MathJax-Span-86" class="mrow"><span style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-87" class="mi">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span style="font-size: 70.7%; font-family: STIXGeneral;" id="MathJax-Span-88" class="mo">+</span><span style="font-size: 70.7%; font-family: STIXGeneral;" id="MathJax-Span-89" class="mn">2</span></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span></span></span><span style="font-family: STIXGeneral;" id="MathJax-Span-90" class="mo">.</span><span style="font-family: STIXGeneral; padding-left: 0.188em;" id="MathJax-Span-91" class="mo">.</span><span style="font-family: STIXGeneral; padding-left: 0.188em;" id="MathJax-Span-92" class="mo">.</span><span style="padding-left: 0.188em;" id="MathJax-Span-93" class="msubsup"><span style="display: inline-block; position: relative; width: 0.929em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.53em, 4.133em, -1000em); top: -3.99em; left: 0em;"><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-94" class="mi">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;"></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.5em;"><span id="MathJax-Span-95" class="texatom"><span id="MathJax-Span-96" class="mrow"><span style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-97" class="mi">n</span></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span></span></span><span style="font-family: STIXGeneral; padding-left: 0.25em;" id="MathJax-Span-98" class="mo">×</span><span style="padding-left: 0.25em;" id="MathJax-Span-99" class="texatom"><span id="MathJax-Span-100" class="mrow"><span style="font-family: STIXGeneral;" id="MathJax-Span-101" class="mi">i</span><span style="font-family: STIXGeneral;" id="MathJax-Span-102" class="mi">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span style="font-family: STIXGeneral;" id="MathJax-Span-103" class="mi">e</span><span style="font-family: STIXGeneral;" id="MathJax-Span-104" class="mi">m</span><span style="font-family: STIXGeneral;" id="MathJax-Span-105" class="mi">s</span><span style="font-family: STIXGeneral;" id="MathJax-Span-106" class="mi">i</span><span style="font-family: STIXGeneral;" id="MathJax-Span-107" class="mi">z</span><span style="font-family: STIXGeneral;" id="MathJax-Span-108" class="mi">e</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span><span style="position: absolute; clip: rect(3.177em, 1010.55em, 4.417em, -1000em); top: -1.908em; left: 0em;"><span id="MathJax-Span-115" class="mtd"><span id="MathJax-Span-116" class="mrow"><span id="MathJax-Span-117" class="mi"></span><span style="font-family: STIXGeneral; padding-left: 0.313em;" id="MathJax-Span-118" class="mo">=</span><span style="padding-left: 0.313em;" id="MathJax-Span-119" class="msubsup"><span style="display: inline-block; position: relative; width: 0.929em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.53em, 4.133em, -1000em); top: -3.99em; left: 0em;"><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-120" class="mi">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;"></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.5em;"><span id="MathJax-Span-121" class="texatom"><span id="MathJax-Span-122" class="mrow"><span style="font-size: 70.7%; font-family: STIXGeneral;" id="MathJax-Span-123" class="mn">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span></span></span><span id="MathJax-Span-124" class="msubsup"><span style="display: inline-block; position: relative; width: 0.929em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.53em, 4.133em, -1000em); top: -3.99em; left: 0em;"><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-125" class="mi">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;"></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.5em;"><span id="MathJax-Span-126" class="texatom"><span id="MathJax-Span-127" class="mrow"><span style="font-size: 70.7%; font-family: STIXGeneral;" id="MathJax-Span-128" class="mn">2</span></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span></span></span><span style="font-family: STIXGeneral;" id="MathJax-Span-129" class="mo">.</span><span style="font-family: STIXGeneral; padding-left: 0.188em;" id="MathJax-Span-130" class="mo">.</span><span style="font-family: STIXGeneral; padding-left: 0.188em;" id="MathJax-Span-131" class="mo">.</span><span style="padding-left: 0.188em;" id="MathJax-Span-132" class="msubsup"><span style="display: inline-block; position: relative; width: 1.61em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.53em, 4.133em, -1000em); top: -3.99em; left: 0em;"><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-133" class="mi">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;"></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.5em;"><span id="MathJax-Span-134" class="texatom"><span id="MathJax-Span-135" class="mrow"><span style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-136" class="mi">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span style="font-size: 70.7%; font-family: STIXGeneral;" id="MathJax-Span-137" class="mo">−</span><span style="font-size: 70.7%; font-family: STIXGeneral;" id="MathJax-Span-138" class="mn">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span></span></span><span style="font-family: STIXGeneral; padding-left: 0.25em;" id="MathJax-Span-139" class="mo">×</span><span style="padding-left: 0.25em;" id="MathJax-Span-140" class="texatom"><span id="MathJax-Span-141" class="mrow"><span style="font-family: STIXGeneral;" id="MathJax-Span-142" class="mi">i</span><span style="font-family: STIXGeneral;" id="MathJax-Span-143" class="mi">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span style="font-family: STIXGeneral;" id="MathJax-Span-144" class="mi">e</span><span style="font-family: STIXGeneral;" id="MathJax-Span-145" class="mi">m</span><span style="font-family: STIXGeneral;" id="MathJax-Span-146" class="mi">s</span><span style="font-family: STIXGeneral;" id="MathJax-Span-147" class="mi">i</span><span style="font-family: STIXGeneral;" id="MathJax-Span-148" class="mi">z</span><span style="font-family: STIXGeneral;" id="MathJax-Span-149" class="mi">e</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span></span><span style="display: inline-block; width: 0px; height: 6.289em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.039em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -3.364em; border-left: 0px solid; width: 0px; height: 7.384em;"></span></span></nobr><span role="presentation" class="MJX_Assistive_MathML MJX_Assistive_MathML_Block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable columnalign="right left" rowspacing="3pt" columnspacing="0em" displaystyle="true"><mtr><mtd><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">s</mi><mi mathvariant="normal">h</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">e</mi></mrow></mtd><mtd><mi></mi><mo>=</mo><mo stretchy="false">(</mo><msub><mi>d</mi><mn>1</mn></msub><mo>,</mo><msub><mi>d</mi><mn>2</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>d</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mtd></mtr><mtr><mtd><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">s</mi></mrow></mtd><mtd><mi></mi><mo>=</mo><mo stretchy="false">(</mo><msub><mi>s</mi><mn>1</mn></msub><mo>,</mo><msub><mi>s</mi><mn>2</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>s</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mtd></mtr><mtr><mtd><msubsup><mi>s</mi><mi>j</mi><mi>C</mi></msubsup></mtd><mtd><mi></mi><mo>=</mo><msub><mi>d</mi><mrow class="MJX-TeXAtom-ORD"><mi>j</mi><mo>+</mo><mn>1</mn></mrow></msub><msub><mi>d</mi><mrow class="MJX-TeXAtom-ORD"><mi>j</mi><mo>+</mo><mn>2</mn></mrow></msub><mo>.</mo><mo>.</mo><mo>.</mo><msub><mi>d</mi><mrow class="MJX-TeXAtom-ORD"><mi>n</mi></mrow></msub><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">i</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">z</mi><mi mathvariant="normal">e</mi></mrow></mtd></mtr><mtr><mtd><msubsup><mi>s</mi><mi>j</mi><mi>F</mi></msubsup></mtd><mtd><mi></mi><mo>=</mo><msub><mi>d</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn></mrow></msub><msub><mi>d</mi><mrow class="MJX-TeXAtom-ORD"><mn>2</mn></mrow></msub><mo>.</mo><mo>.</mo><mo>.</mo><msub><mi>d</mi><mrow class="MJX-TeXAtom-ORD"><mi>j</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">i</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">z</mi><mi mathvariant="normal">e</mi></mrow></mtd></mtr></mtable></math></span></span></div><script id="MathJax-Element-1" type="math/tex; mode=display">\begin{split}\mathrm{shape} &= (d_1, d_2, ..., d_n)
\\
\mathrm{strides} &= (s_1, s_2, ..., s_n)
\\
s_j^C &= d_{j+1} d_{j+2} ... d_{n} \times \mathrm{itemsize}
\\
s_j^F &= d_{1} d_{2} ... d_{j-1} \times \mathrm{itemsize}\end{split}</script></div>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p><code class="docutils literal"><span class="pre">.view()</span></code> の振る舞いについて理解できるようになりましょう:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<div class="newline"></div></pre></div>
</div>
<p>転置はデータのメモリレイアウトに影響を与えず、ストライドのみに影響します</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">strides</span>
<div class="newline"></div><span class="go">(2, 1)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="o">.</span><span class="n">strides</span>
<div class="newline"></div><span class="go">(1, 2)</span>
<div class="newline"></div></pre></div>
</div>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>  
<div class="newline"></div><span class="go">'\x01\x02\x03\x04'</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>  
<div class="newline"></div><span class="go">'\x01\x03\x02\x04'</span>
<div class="newline"></div></pre></div>
</div>
<ul class="last simple">
<li><p class="first">int16 2つと解釈した場合の結果は異なります</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">.copy()</span></code> は (デフォルトの) C での順序で新しい配列を作成します</p>
</li>
</ul>
</div>
</div>
<div class="section" id="slicing-with-integers">
<h5>2.2.1.4.1.2. 整数によるスライス<a class="headerlink" href="#slicing-with-integers" title="このヘッドラインへのパーマリンク">¶</a></h5>
<ul class="simple">
<li><p class="first"><em>全て</em> を <code class="docutils literal"><span class="pre">shape</span></code> や <code class="docutils literal"><span class="pre">strides</span></code> そして、ことによると <code class="docutils literal"><span class="pre">data</span></code> ポインタの調整のみで表現することができます。</p>
</li>
<li><p class="first">データのコピーを作りません</p>
</li>
</ul>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span>
<div class="newline"></div><span class="go">array([6, 5, 4, 3, 2, 1], dtype=int32)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="o">.</span><span class="n">strides</span>
<div class="newline"></div><span class="go">(-4,)</span>
<div class="newline"></div>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="o">.</span><span class="n">__array_interface__</span><span class="p">[</span><span class="s">'data'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">__array_interface__</span><span class="p">[</span><span class="s">'data'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<div class="newline"></div><span class="go">8</span>
<div class="newline"></div>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">strides</span>
<div class="newline"></div><span class="go">(800, 80, 8)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">[::</span><span class="mi">2</span><span class="p">,::</span><span class="mi">3</span><span class="p">,::</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">strides</span>
<div class="newline"></div><span class="go">(1600, 240, 32)</span>
<div class="newline"></div></pre></div>
</div>
<ul>
<li><p class="first">同様に転置はコピーを作りません(単にストライドを交換します):</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">strides</span>
<div class="newline"></div><span class="go">(800, 80, 8)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">strides</span>
<div class="newline"></div><span class="go">(8, 80, 800)</span>
<div class="newline"></div></pre></div>
</div>
</li>
</ul>
<p>ただ、全てのリシェイプ操作がストラウドで表現できるわけではありません:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">T</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">strides</span>
<div class="newline"></div><span class="go">(1, 2)</span>
<div class="newline"></div></pre></div>
</div>
<p>今のところは順調です。しかし:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>  
<div class="newline"></div><span class="go">'\x00\x01\x02\x03\x04\x05'</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span>
<div class="newline"></div><span class="go">array([[0, 2, 4],</span>
<div class="newline"></div><span class="go">       [1, 3, 5]], dtype=int8)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span>
<div class="newline"></div><span class="go">array([0, 2, 4, 1, 3, 5], dtype=int8)</span>
<div class="newline"></div></pre></div>
</div>
<p>このように、配列 <code class="docutils literal"><span class="pre">c</span></code> を1つのストライドと <code class="docutils literal"><span class="pre">a</span></code> のメモリブロックで表現することはできません。つまり <code class="docutils literal"><span class="pre">reshape</span></code> 演算にはコピーが必要です。</p>
</div>
</div>
<div class="section" id="example-fake-dimensions-with-strides">
<span id="stride-manipulation-label"></span><h4>2.2.1.4.2. 例: ストライドで次元を偽装する<a class="headerlink" href="#example-fake-dimensions-with-strides" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p class="rubric">ストライドの操作</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">numpy.lib.stride_tricks</span> <span class="kn">import</span> <span class="n">as_strided</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">help</span><span class="p">(</span><span class="n">as_strided</span><span class="p">)</span>    
<div class="newline"></div><span class="go">as_strided(x, shape=None, strides=None)</span>
<div class="newline"></div><span class="go">   Make an ndarray from the given array with the given shape and strides</span>
<div class="newline"></div></pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last"><code class="docutils literal"><span class="pre">as_strided</span></code> はメモリブロックの境界内におさまっているか確認 <strong>しません</strong>...</p>
</div>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">as_strided</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="p">),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">))</span>
<div class="newline"></div><span class="go">array([1, 3], dtype=int16)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
<div class="newline"></div><span class="go">array([1, 3], dtype=int16)</span>
<div class="newline"></div></pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last">stride-fakedims.py</p>
</div>
<p><strong>練習問題</strong></p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>array([1, 2, 3, 4], dtype=np.int8)
<div class="newline"></div>
<div class="newline"></div>-&gt; array([[1, 2, 3, 4],
<div class="newline"></div>          [1, 2, 3, 4],
<div class="newline"></div>          [1, 2, 3, 4]], dtype=np.int8)
<div class="newline"></div></pre></div>
</div>
<p><code class="docutils literal"><span class="pre">as_strided</span></code> のみを利用します:</p>
<div class="highlight-python"><div class="highlight"><pre>Hint: byte_offset = stride[0]*index[0] + stride[1]*index[1] + ...
<div class="newline"></div></pre></div>
</div>
</div></blockquote>
<p><em>ネタバレ</em></p>
<blockquote>
<div><a onclick="$('#hidden-item-1').toggle(100)">...</a>
<div id="hidden-item-1" style="display: none;"><p>ストライドは <em>0</em> にすることもできます:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">as_strided</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span>
<div class="newline"></div><span class="go">array([[1, 2, 3, 4],</span>
<div class="newline"></div><span class="go">       [1, 2, 3, 4],</span>
<div class="newline"></div><span class="go">       [1, 2, 3, 4]], dtype=int8)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">base</span> <span class="ow">is</span> <span class="n">x</span>
<div class="newline"></div><span class="go">True</span>
<div class="newline"></div></pre></div>
</div>
</div></div></blockquote>
</div>
<div class="section" id="broadcasting">
<span id="id2"></span><h4>2.2.1.4.3. ブロードキャスト<a class="headerlink" href="#broadcasting" title="このヘッドラインへのパーマリンク">¶</a></h4>
<ul class="simple">
<li><p class="first">これを使って何か便利なことをしてみましょう: <code class="docutils literal"><span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">3,</span> <span class="pre">4]</span></code> と <code class="docutils literal"><span class="pre">[5,</span> <span class="pre">6,</span> <span class="pre">7]</span></code> の外積</p>
</li>
</ul>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x2</span> <span class="o">=</span> <span class="n">as_strided</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x2</span>
<div class="newline"></div><span class="go">array([[1, 2, 3, 4],</span>
<div class="newline"></div><span class="go">       [1, 2, 3, 4],</span>
<div class="newline"></div><span class="go">       [1, 2, 3, 4]], dtype=int16)</span>
<div class="newline"></div></pre></div>
</div>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y2</span> <span class="o">=</span> <span class="n">as_strided</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y2</span>
<div class="newline"></div><span class="go">array([[5, 5, 5, 5],</span>
<div class="newline"></div><span class="go">       [6, 6, 6, 6],</span>
<div class="newline"></div><span class="go">       [7, 7, 7, 7]], dtype=int16)</span>
<div class="newline"></div></pre></div>
</div>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x2</span> <span class="o">*</span> <span class="n">y2</span>
<div class="newline"></div><span class="go">array([[ 5, 10, 15, 20],</span>
<div class="newline"></div><span class="go">       [ 6, 12, 18, 24],</span>
<div class="newline"></div><span class="go">       [ 7, 14, 21, 28]], dtype=int16)</span>
<div class="newline"></div></pre></div>
</div>
<p class="rubric">... こうするといくらか親しみあるものに見えます ...</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span> <span class="o">*</span> <span class="n">y</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
<div class="newline"></div><span class="go">array([[ 5, 10, 15, 20],</span>
<div class="newline"></div><span class="go">       [ 6, 12, 18, 24],</span>
<div class="newline"></div><span class="go">       [ 7, 14, 21, 28]], dtype=int16)</span>
<div class="newline"></div></pre></div>
</div>
<ul class="simple">
<li><p class="first">内部的に、配列の <strong>ブロードキャスト</strong> は本当に 0ストライドを利用して実装されています。</p>
</li>
</ul>
</div>
<div class="section" id="more-tricks-diagonals">
<h4>2.2.1.4.4. さらなる工夫: 対角要素<a class="headerlink" href="#more-tricks-diagonals" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last">stride-diagonals.py</p>
</div>
<p><strong>挑戦</strong></p>
<blockquote>
<div><ul>
<li><p class="first">行列の対角要素を拾ってみましょう: (C メモリ順序を過程します):</p>
<div class="highlight-python"><div class="highlight"><pre>&gt;&gt;&gt; x = np.array([[1, 2, 3],
<div class="newline"></div>...               [4, 5, 6],
<div class="newline"></div>...               [7, 8, 9]], dtype=np.int32)
<div class="newline"></div>
<div class="newline"></div>&gt;&gt;&gt; x_diag = as_strided(x, shape=(3,), strides=(???,)) 
<div class="newline"></div></pre></div>
</div>
</li>
<li><p class="first">まず <code class="docutils literal"><span class="pre">[2,</span> <span class="pre">6]</span></code> の上対角成分を拾ってみましょう。</p>
</li>
<li><p class="first">そして、下対角成分はどうなるでしょう?</p>
</li>
</ul>
<dl class="docutils">
<dt>(最後2つのヒント: スライスして、ストライドが開始するポインタを動かします</dt>
<dd><p class="first last">。)</p>
</dd>
</dl>
</div></blockquote>
<p><em>解答</em></p>
<blockquote>
<div><a onclick="$('#hidden-item-2').toggle(100)">...</a>
<div id="hidden-item-2" style="display: none;"><p>対角要素を拾う:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x_diag</span> <span class="o">=</span> <span class="n">as_strided</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="p">),</span> <span class="n">strides</span><span class="o">=</span><span class="p">((</span><span class="mi">3</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">itemsize</span><span class="p">,</span> <span class="p">))</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x_diag</span>
<div class="newline"></div><span class="go">array([1, 5, 9], dtype=int32)</span>
<div class="newline"></div></pre></div>
</div>
<p>最初にスライスしてデータポインタを調整する:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">as_strided</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">),</span> <span class="n">strides</span><span class="o">=</span><span class="p">((</span><span class="mi">3</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">itemsize</span><span class="p">,</span> <span class="p">))</span>
<div class="newline"></div><span class="go">array([2, 6], dtype=int32)</span>
<div class="newline"></div>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">as_strided</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">),</span> <span class="n">strides</span><span class="o">=</span><span class="p">((</span><span class="mi">3</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">itemsize</span><span class="p">,</span> <span class="p">))</span>
<div class="newline"></div><span class="go">array([4, 8], dtype=int32)</span>
<div class="newline"></div></pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p><strong>np.diag を利用する</strong></p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span>
<div class="newline"></div><span class="go">array([2, 6], dtype=int32)</span>
<div class="newline"></div></pre></div>
</div>
<p>しかし、</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">owndata</span>  
<div class="newline"></div><span class="go">False</span>
<div class="newline"></div></pre></div>
</div>
<p class="last"><strong>注意</strong> この動きは変更されています: numpy 1.9 より前では np.diag はコピーします。</p>
</div>
</div></div></blockquote>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last">stride-diagonals.py</p>
</div>
<p><strong>挑戦</strong></p>
<blockquote>
<div><p>テンソルのトレースを計算する:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="mi">5</span><span class="o">*</span><span class="mi">5</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
<div class="newline"></div><span class="gp">... </span>   <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
<div class="newline"></div><span class="gp">... </span>      <span class="n">s</span> <span class="o">+=</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
<div class="newline"></div></pre></div>
</div>
<p>ストライドとその結果の <code class="docutils literal"><span class="pre">sum()</span></code> で:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">as_strided</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="n">TODO</span><span class="p">,</span> <span class="n">TODO</span><span class="p">))</span>   
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="o">...</span>   
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span> <span class="o">==</span> <span class="n">s2</span>   
<div class="newline"></div></pre></div>
</div>
</div></blockquote>
<p><em>解答</em></p>
<blockquote>
<div><a onclick="$('#hidden-item-2-2').toggle(100)">...</a>
<div id="hidden-item-2-2" style="display: none;"><div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">as_strided</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">strides</span><span class="o">=</span><span class="p">((</span><span class="mi">5</span><span class="o">*</span><span class="mi">5</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">itemsize</span><span class="p">,</span>
<div class="newline"></div><span class="gp">... </span>                                         <span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">itemsize</span><span class="p">))</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<div class="newline"></div></pre></div>
</div>
</div></div></blockquote>
</div>
<div class="section" id="cpu-cache-effects">
<span id="cache-effects"></span><h4>2.2.1.4.5. CPU キャッシュの効果<a class="headerlink" href="#cpu-cache-effects" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>メモリレイアウトはパフォーマンスに影響を与えます:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1]: </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">20000</span><span class="p">,))</span>
<div class="newline"></div>
<div class="newline"></div><span class="gp">In [2]: </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">20000</span><span class="o">*</span><span class="mi">67</span><span class="p">,))[::</span><span class="mi">67</span><span class="p">]</span>
<div class="newline"></div>
<div class="newline"></div><span class="gp">In [3]: </span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span>
<div class="newline"></div><span class="go">((20000,), (20000,))</span>
<div class="newline"></div>
<div class="newline"></div><span class="gp">In [4]: </span><span class="o">%</span><span class="n">timeit</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<div class="newline"></div><span class="go">100000 loops, best of 3: 0.180 ms per loop</span>
<div class="newline"></div>
<div class="newline"></div><span class="gp">In [5]: </span><span class="o">%</span><span class="n">timeit</span> <span class="n">y</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<div class="newline"></div><span class="go">100000 loops, best of 3: 2.34 ms per loop</span>
<div class="newline"></div>
<div class="newline"></div><span class="gp">In [6]: </span><span class="n">x</span><span class="o">.</span><span class="n">strides</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">strides</span>
<div class="newline"></div><span class="go">((8,), (536,))</span>
<div class="newline"></div></pre></div>
</div>
<p class="rubric">小さいストライドの方が速い?</p>
<img alt="../../_images/cpu-cacheline.png" src="2.2.%20Numpy%20%E3%81%AE%E5%85%88%E9%80%B2%E7%9A%84%E3%81%AA%E6%A9%9F%E8%83%BD%20%E2%80%94%20Scipy%20lecture%20notes_files/cpu-cacheline.png">
<ul class="simple">
<li><p class="first">CPU はメインメモリから CPU キャッシュブロック内にデータを引っぱりだします</p>
</li>
<li><p class="first">多くの配列要素が、(小さいストライドで)単一ブロック内に収まって、連続して演算される場合:</p>
<ul>
<li><p class="first"><span class="math"><span style="color: inherit; display: none;" class="MathJax_Preview"></span><span role="presentation" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x21D2;&lt;/mo&gt;&lt;/math&gt;" style="position: relative;" tabindex="0" id="MathJax-Element-2-Frame" class="MathJax"><nobr aria-hidden="true"><span style="width: 1.217em; display: inline-block;" id="MathJax-Span-150" class="math"><span style="display: inline-block; position: relative; width: 0.911em; height: 0px; font-size: 131%;"><span style="position: absolute; clip: rect(1.878em, 1000.85em, 2.734em, -1000em); top: -2.559em; left: 0em;"><span id="MathJax-Span-151" class="mrow"><span style="font-family: STIXGeneral;" id="MathJax-Span-152" class="mo">⇒</span></span><span style="display: inline-block; width: 0px; height: 2.559em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.116em; border-left: 0px solid; width: 0px; height: 0.894em;"></span></span></nobr><span role="presentation" class="MJX_Assistive_MathML"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">⇒</mo></math></span></span><script id="MathJax-Element-2" type="math/tex">\Rightarrow</script></span> 必要な転送が少なくなります</p>
</li>
<li><span class="math"><span style="color: inherit; display: none;" class="MathJax_Preview"></span><span role="presentation" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x21D2;&lt;/mo&gt;&lt;/math&gt;" style="position: relative;" tabindex="0" id="MathJax-Element-3-Frame" class="MathJax"><nobr aria-hidden="true"><span style="width: 1.217em; display: inline-block;" id="MathJax-Span-153" class="math"><span style="display: inline-block; position: relative; width: 0.911em; height: 0px; font-size: 131%;"><span style="position: absolute; clip: rect(1.878em, 1000.85em, 2.734em, -1000em); top: -2.559em; left: 0em;"><span id="MathJax-Span-154" class="mrow"><span style="font-family: STIXGeneral;" id="MathJax-Span-155" class="mo">⇒</span></span><span style="display: inline-block; width: 0px; height: 2.559em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.116em; border-left: 0px solid; width: 0px; height: 0.894em;"></span></span></nobr><span role="presentation" class="MJX_Assistive_MathML"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">⇒</mo></math></span></span><script id="MathJax-Element-3" type="math/tex">\Rightarrow</script></span> faster</li>
</ul>
</li>
</ul>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last"><a class="reference external" href="http://code.google.com/p/numexpr/">numexpr</a> は配列計算でのキャッシュ効果を軽減するよう設計されています。</p>
</div>
</div>
<div class="section" id="example-inplace-operations-caveat-emptor">
<h4>2.2.1.4.6. 例: インプレースな演算 (買手責任)<a class="headerlink" href="#example-inplace-operations-caveat-emptor" title="このヘッドラインへのパーマリンク">¶</a></h4>
<ul>
<li><p class="first">しばしば</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">-=</span> <span class="n">b</span>    
<div class="newline"></div></pre></div>
</div>
<p>は以下と同じになりません</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">-=</span> <span class="n">b</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>    
<div class="newline"></div></pre></div>
</div>
</li>
</ul>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">-=</span> <span class="n">x</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>   
<div class="newline"></div><span class="go">array([[ 0, -1],</span>
<div class="newline"></div><span class="go">       [ 4,  0]])</span>
<div class="newline"></div></pre></div>
</div>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">-=</span> <span class="n">y</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span>
<div class="newline"></div><span class="go">array([[ 0, -1],</span>
<div class="newline"></div><span class="go">       [ 1,  0]])</span>
<div class="newline"></div></pre></div>
</div>
<ul class="simple">
<li><p class="first"><code class="docutils literal"><span class="pre">x</span></code> と <a href="#id1"><span class="problematic" id="id2">``</span></a>x.transpose()` はデータを共有します</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">x</span> <span class="pre">-=</span> <span class="pre">x.transpose()</span></code> はデータを要素毎に変更します...</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">x</span></code> と <a href="#id1"><span class="problematic" id="id2">``</span></a>x.transpose()` は異なるストライドを持ち、変更されたデータが右辺側に再度あらわれます</p>
</li>
</ul>
</div>
</div>
<div class="section" id="findings-in-dissection">
<h3><a class="toc-backref" href="#id9">2.2.1.5. 解剖により得た知見</a><a class="headerlink" href="#findings-in-dissection" title="このヘッドラインへのパーマリンク">¶</a></h3>
<img alt="../../_images/threefundamental.png" src="2.2.%20Numpy%20%E3%81%AE%E5%85%88%E9%80%B2%E7%9A%84%E3%81%AA%E6%A9%9F%E8%83%BD%20%E2%80%94%20Scipy%20lecture%20notes_files/threefundamental.png">
<ul class="simple">
<li><p class="first"><em>メモリブロック</em>: 共有されうる <code class="docutils literal"><span class="pre">.base</span></code>, <code class="docutils literal"><span class="pre">.data</span></code></p>
</li>
<li><p class="first"><em>データ型デスクリプタ</em>: 構造化されたデータ, サブ配列, バイトオーダー, キャスト, ビュー, <code class="docutils literal"><span class="pre">.astype()</span></code>, <code class="docutils literal"><span class="pre">.view()</span></code></p>
</li>
<li><p class="first"><em>ストライドインデクス</em>: ストライド, C/F 順序, 整数によるスライス, <code class="docutils literal"><span class="pre">as_strided</span></code>, ブロードキャスト, ストライドの工夫, <code class="docutils literal"><span class="pre">diag</span></code>, CPU キャッシュコヒーレンス</p>
</li>
</ul>
</div>
</div>
<div class="section" id="universal-functions">
<h2><a class="toc-backref" href="#id10">2.2.2. ユニバーサル関数</a><a class="headerlink" href="#universal-functions" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="what-they-are">
<h3><a class="toc-backref" href="#id11">2.2.2.1. とは何か?</a><a class="headerlink" href="#what-they-are" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul>
<li><p class="first">ufunc は配列の全ての要素に対して要素毎の演算を行ないます。</p>
<p>例:</p>
<div class="highlight-python"><div class="highlight"><pre>np.add, np.subtract, scipy.special.*, ...
<div class="newline"></div></pre></div>
</div>
</li>
<li><p class="first">自動でのサポート: ブロードキャスト、キャストなど...</p>
</li>
<li><p class="first">ufunc の作者は要素毎の演算をサポートだけをします、Numpy が残りをケアしてくれます。</p>
</li>
<li><p class="first">要素毎の演算は C で(あるいは Cython などで) 実装する必要があります</p>
</li>
</ul>
<div class="section" id="parts-of-an-ufunc">
<h4>2.2.2.1.1. ufunc のパーツ<a class="headerlink" href="#parts-of-an-ufunc" title="このヘッドラインへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><p class="first">ユーザにより提供されるもの</p>
<div class="highlight-c"><div class="highlight"><pre><span class="kt">void</span> <span class="nf">ufunc_loop</span><span class="p">(</span><span class="kt">void</span> <span class="o">**</span><span class="n">args</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">dimensions</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">steps</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<div class="newline"></div><span class="p">{</span>
<div class="newline"></div>    <span class="cm">/*</span>
<div class="newline"></div><span class="cm">     * int8 output = elementwise_function(int8 input_1, int8 input_2)</span>
<div class="newline"></div><span class="cm">     *</span>
<div class="newline"></div><span class="cm">     * This function must compute the ufunc for many values at once,</span>
<div class="newline"></div><span class="cm">     * in the way shown below.</span>
<div class="newline"></div><span class="cm">     */</span>
<div class="newline"></div>    <span class="kt">char</span> <span class="o">*</span><span class="n">input_1</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<div class="newline"></div>    <span class="kt">char</span> <span class="o">*</span><span class="n">input_2</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<div class="newline"></div>    <span class="kt">char</span> <span class="o">*</span><span class="n">output</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<div class="newline"></div>    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<div class="newline"></div>
<div class="newline"></div>    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
<div class="newline"></div>        <span class="o">*</span><span class="n">output</span> <span class="o">=</span> <span class="n">elementwise_function</span><span class="p">(</span><span class="o">*</span><span class="n">input_1</span><span class="p">,</span> <span class="o">*</span><span class="n">input_2</span><span class="p">);</span>
<div class="newline"></div>        <span class="n">input_1</span> <span class="o">+=</span> <span class="n">steps</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<div class="newline"></div>        <span class="n">input_2</span> <span class="o">+=</span> <span class="n">steps</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<div class="newline"></div>        <span class="n">output</span> <span class="o">+=</span> <span class="n">steps</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<div class="newline"></div>    <span class="p">}</span>
<div class="newline"></div><span class="p">}</span>
<div class="newline"></div></pre></div>
</div>
</li>
<li><p class="first">以下により作られる Numpy 部分</p>
<div class="highlight-c"><div class="highlight"><pre><span class="kt">char</span> <span class="n">types</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<div class="newline"></div>
<div class="newline"></div><span class="n">types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">NPY_BYTE</span>   <span class="cm">/* type of first input arg */</span>
<div class="newline"></div><span class="n">types</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">NPY_BYTE</span>   <span class="cm">/* type of second input arg */</span>
<div class="newline"></div><span class="n">types</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">NPY_BYTE</span>   <span class="cm">/* type of third input arg */</span>
<div class="newline"></div>
<div class="newline"></div><span class="n">PyObject</span> <span class="o">*</span><span class="n">python_ufunc</span> <span class="o">=</span> <span class="n">PyUFunc_FromFuncAndData</span><span class="p">(</span>
<div class="newline"></div>    <span class="n">ufunc_loop</span><span class="p">,</span>
<div class="newline"></div>    <span class="nb">NULL</span><span class="p">,</span>
<div class="newline"></div>    <span class="n">types</span><span class="p">,</span>
<div class="newline"></div>    <span class="mi">1</span><span class="p">,</span> <span class="cm">/* ntypes */</span>
<div class="newline"></div>    <span class="mi">2</span><span class="p">,</span> <span class="cm">/* num_inputs */</span>
<div class="newline"></div>    <span class="mi">1</span><span class="p">,</span> <span class="cm">/* num_outputs */</span>
<div class="newline"></div>    <span class="n">identity_element</span><span class="p">,</span>
<div class="newline"></div>    <span class="n">name</span><span class="p">,</span>
<div class="newline"></div>    <span class="n">docstring</span><span class="p">,</span>
<div class="newline"></div>    <span class="n">unused</span><span class="p">)</span>
<div class="newline"></div></pre></div>
</div>
<ul class="simple">
<li><p class="first">ufunc は複数の入出力型の組み合わせをサポートすることもできます。</p>
</li>
</ul>
</li>
</ol>
</div>
<div class="section" id="making-it-easier">
<h4>2.2.2.1.2. 易しくしてみましょう<a class="headerlink" href="#making-it-easier" title="このヘッドラインへのパーマリンク">¶</a></h4>
<ol class="arabic" start="3">
<li><p class="first"><code class="docutils literal"><span class="pre">ufunc_loop</span></code> はとても汎用的な形式なので Numpy はあらかじめ特化した関数を用意しています</p>
<table class="docutils" border="1">
<colgroup>
<col width="18%">
<col width="82%">
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">PyUfunc_f_f</span></code></td>
<td><code class="docutils literal"><span class="pre">float</span> <span class="pre">elementwise_func(float</span> <span class="pre">input_1)</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">PyUfunc_ff_f</span></code></td>
<td><code class="docutils literal"><span class="pre">float</span> <span class="pre">elementwise_func(float</span> <span class="pre">input_1,</span> <span class="pre">float</span> <span class="pre">input_2)</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">PyUfunc_d_d</span></code></td>
<td><code class="docutils literal"><span class="pre">double</span> <span class="pre">elementwise_func(double</span> <span class="pre">input_1)</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">PyUfunc_dd_d</span></code></td>
<td><code class="docutils literal"><span class="pre">double</span> <span class="pre">elementwise_func(double</span> <span class="pre">input_1,</span> <span class="pre">double</span> <span class="pre">input_2)</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">PyUfunc_D_D</span></code></td>
<td><code class="docutils literal"><span class="pre">elementwise_func(npy_cdouble</span> <span class="pre">*input,</span> <span class="pre">npy_cdouble*</span> <span class="pre">output)</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">PyUfunc_DD_D</span></code></td>
<td><code class="docutils literal"><span class="pre">elementwise_func(npy_cdouble</span> <span class="pre">*in1,</span> <span class="pre">npy_cdouble</span> <span class="pre">*in2,</span> <span class="pre">npy_cdouble*</span> <span class="pre">out)</span></code></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p class="first"><code class="docutils literal"><span class="pre">elementwise_func</span></code> のみ埋める必要があります</p>
</li>
<li>... except when your elementwise function is not in one of the above forms</li>
</ul>
</li>
</ol>
</div>
</div>
<div class="section" id="exercise-building-an-ufunc-from-scratch">
<h3><a class="toc-backref" href="#id12">2.2.2.2. 演習: ufunc をスクラッチから作る</a><a class="headerlink" href="#exercise-building-an-ufunc-from-scratch" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>反復により定義された Mandelbrot フラクタル</p>
<div class="math">
<span style="color: inherit; display: none;" class="MathJax_Preview"></span><div style="text-align: center;" class="MathJax_Display"><span role="presentation" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2190;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;/math&gt;" style="text-align: center; position: relative;" tabindex="0" id="MathJax-Element-4-Frame" class="MathJax"><nobr aria-hidden="true"><span style="width: 5.771em; display: inline-block;" id="MathJax-Span-156" class="math"><span style="display: inline-block; position: relative; width: 4.381em; height: 0px; font-size: 131%;"><span style="position: absolute; clip: rect(1.538em, 1004.36em, 2.77em, -1000em); top: -2.559em; left: 0em;"><span id="MathJax-Span-157" class="mrow"><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-158" class="mi">z</span><span style="font-family: STIXGeneral; padding-left: 0.313em;" id="MathJax-Span-159" class="mo">←</span><span style="padding-left: 0.313em;" id="MathJax-Span-160" class="msubsup"><span style="display: inline-block; position: relative; width: 0.818em; height: 0px;"><span style="position: absolute; clip: rect(3.432em, 1000.38em, 4.201em, -1000em); top: -3.99em; left: 0em;"><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-161" class="mi">z</span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span><span style="position: absolute; top: -4.403em; left: 0.389em;"><span style="font-size: 70.7%; font-family: STIXGeneral;" id="MathJax-Span-162" class="mn">2</span><span style="display: inline-block; width: 0px; height: 3.99em;"></span></span></span></span><span style="font-family: STIXGeneral; padding-left: 0.25em;" id="MathJax-Span-163" class="mo">+</span><span style="font-family: STIXGeneral; font-style: italic; padding-left: 0.25em;" id="MathJax-Span-164" class="mi">c</span></span><span style="display: inline-block; width: 0px; height: 2.559em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.163em; border-left: 0px solid; width: 0px; height: 1.387em;"></span></span></nobr><span role="presentation" class="MJX_Assistive_MathML MJX_Assistive_MathML_Block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>z</mi><mo stretchy="false">←</mo><msup><mi>z</mi><mn>2</mn></msup><mo>+</mo><mi>c</mi></math></span></span></div><script id="MathJax-Element-4" type="math/tex; mode=display">z \leftarrow z^2 + c</script></div>
<p>ここで <span class="math"><span style="color: inherit; display: none;" class="MathJax_Preview"></span><span role="presentation" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" style="position: relative;" tabindex="0" id="MathJax-Element-5-Frame" class="MathJax"><nobr aria-hidden="true"><span style="width: 5.337em; display: inline-block;" id="MathJax-Span-165" class="math"><span style="display: inline-block; position: relative; width: 4.077em; height: 0px; font-size: 131%;"><span style="position: absolute; clip: rect(1.775em, 1004.06em, 2.895em, -1000em); top: -2.559em; left: 0em;"><span id="MathJax-Span-166" class="mrow"><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-167" class="mi">c</span><span style="font-family: STIXGeneral; padding-left: 0.313em;" id="MathJax-Span-168" class="mo">=</span><span style="font-family: STIXGeneral; font-style: italic; padding-left: 0.313em;" id="MathJax-Span-169" class="mi">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="font-family: STIXGeneral; padding-left: 0.25em;" id="MathJax-Span-170" class="mo">+</span><span style="font-family: STIXGeneral; font-style: italic; padding-left: 0.25em;" id="MathJax-Span-171" class="mi">i</span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-172" class="mi">y</span></span><span style="display: inline-block; width: 0px; height: 2.559em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.327em; border-left: 0px solid; width: 0px; height: 1.24em;"></span></span></nobr><span role="presentation" class="MJX_Assistive_MathML"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi><mo>=</mo><mi>x</mi><mo>+</mo><mi>i</mi><mi>y</mi></math></span></span><script id="MathJax-Element-5" type="math/tex">c = x + i y</script></span> は複素数です。この反復を続けて – <span class="math"><span style="color: inherit; display: none;" class="MathJax_Preview"></span><span role="presentation" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/math&gt;" style="position: relative;" tabindex="0" id="MathJax-Element-6-Frame" class="MathJax"><nobr aria-hidden="true"><span style="width: 0.523em; display: inline-block;" id="MathJax-Span-173" class="math"><span style="display: inline-block; position: relative; width: 0.39em; height: 0px; font-size: 131%;"><span style="position: absolute; clip: rect(2.001em, 1000.38em, 2.77em, -1000em); top: -2.559em; left: 0em;"><span id="MathJax-Span-174" class="mrow"><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-175" class="mi">z</span></span><span style="display: inline-block; width: 0px; height: 2.559em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.163em; border-left: 0px solid; width: 0px; height: 0.78em;"></span></span></nobr><span role="presentation" class="MJX_Assistive_MathML"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi></math></span></span><script id="MathJax-Element-6" type="math/tex">z</script></span> がどれだけ反復されても有限に留まる場合 <span class="math"><span style="color: inherit; display: none;" class="MathJax_Preview"></span><span role="presentation" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;/math&gt;" style="position: relative;" tabindex="0" id="MathJax-Element-7-Frame" class="MathJax"><nobr aria-hidden="true"><span style="width: 0.566em; display: inline-block;" id="MathJax-Span-176" class="math"><span style="display: inline-block; position: relative; width: 0.434em; height: 0px; font-size: 131%;"><span style="position: absolute; clip: rect(1.988em, 1000.41em, 2.7em, -1000em); top: -2.559em; left: 0em;"><span id="MathJax-Span-177" class="mrow"><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-178" class="mi">c</span></span><span style="display: inline-block; width: 0px; height: 2.559em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.071em; border-left: 0px solid; width: 0px; height: 0.706em;"></span></span></nobr><span role="presentation" class="MJX_Assistive_MathML"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi></math></span></span><script id="MathJax-Element-7" type="math/tex">c</script></span> は Mandelbrot 集合に属します。</p>
<ul>
<li><p class="first">以下を計算する <code class="docutils literal"><span class="pre">mandel(z0,</span> <span class="pre">c)</span></code> ufunc を作りましょう:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">z</span> <span class="o">=</span> <span class="n">z0</span>
<div class="newline"></div><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
<div class="newline"></div>    <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="o">*</span><span class="n">z</span> <span class="o">+</span> <span class="n">c</span>
<div class="newline"></div></pre></div>
</div>
<p>つまり、100回反復するか <code class="docutils literal"><span class="pre">z.real**2</span> <span class="pre">+</span> <span class="pre">z.imag**2</span> <span class="pre">&gt;</span> <span class="pre">1000</span></code> するかです。これを利用して <cite>c</cite> が Mandelbrot 集合に属するか決めてみましょう。</p>
</li>
<li><p class="first">関数は単純にするために <code class="docutils literal"><span class="pre">PyUFunc_*</span></code> ヘルパー関数を利用することにしましょう。</p>
</li>
<li><p class="first">Cython で書く</p>
</li>
</ul>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last">mandel.pyx, mandelplot.py</p>
</div>
<p>注意: いくつかの既製品の ufunc ループ:</p>
<table class="docutils" border="1">
<colgroup>
<col width="16%">
<col width="84%">
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">PyUfunc_f_f</span></code></td>
<td><code class="docutils literal"><span class="pre">float</span> <span class="pre">elementwise_func(float</span> <span class="pre">input_1)</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">PyUfunc_ff_f</span></code></td>
<td><code class="docutils literal"><span class="pre">float</span> <span class="pre">elementwise_func(float</span> <span class="pre">input_1,</span> <span class="pre">float</span> <span class="pre">input_2)</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">PyUfunc_d_d</span></code></td>
<td><code class="docutils literal"><span class="pre">double</span> <span class="pre">elementwise_func(double</span> <span class="pre">input_1)</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">PyUfunc_dd_d</span></code></td>
<td><code class="docutils literal"><span class="pre">double</span> <span class="pre">elementwise_func(double</span> <span class="pre">input_1,</span> <span class="pre">double</span> <span class="pre">input_2)</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">PyUfunc_D_D</span></code></td>
<td><code class="docutils literal"><span class="pre">elementwise_func(complex_double</span> <span class="pre">*input,</span> <span class="pre">complex_double*</span> <span class="pre">output)</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">PyUfunc_DD_D</span></code></td>
<td><code class="docutils literal"><span class="pre">elementwise_func(complex_double</span> <span class="pre">*in1,</span> <span class="pre">complex_double</span> <span class="pre">*in2,</span> <span class="pre">complex_double*</span> <span class="pre">out)</span></code></td>
</tr>
</tbody>
</table>
<p>型コード:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">NPY_BOOL</span><span class="p">,</span> <span class="n">NPY_BYTE</span><span class="p">,</span> <span class="n">NPY_UBYTE</span><span class="p">,</span> <span class="n">NPY_SHORT</span><span class="p">,</span> <span class="n">NPY_USHORT</span><span class="p">,</span> <span class="n">NPY_INT</span><span class="p">,</span> <span class="n">NPY_UINT</span><span class="p">,</span>
<div class="newline"></div><span class="n">NPY_LONG</span><span class="p">,</span> <span class="n">NPY_ULONG</span><span class="p">,</span> <span class="n">NPY_LONGLONG</span><span class="p">,</span> <span class="n">NPY_ULONGLONG</span><span class="p">,</span> <span class="n">NPY_FLOAT</span><span class="p">,</span> <span class="n">NPY_DOUBLE</span><span class="p">,</span>
<div class="newline"></div><span class="n">NPY_LONGDOUBLE</span><span class="p">,</span> <span class="n">NPY_CFLOAT</span><span class="p">,</span> <span class="n">NPY_CDOUBLE</span><span class="p">,</span> <span class="n">NPY_CLONGDOUBLE</span><span class="p">,</span> <span class="n">NPY_DATETIME</span><span class="p">,</span>
<div class="newline"></div><span class="n">NPY_TIMEDELTA</span><span class="p">,</span> <span class="n">NPY_OBJECT</span><span class="p">,</span> <span class="n">NPY_STRING</span><span class="p">,</span> <span class="n">NPY_UNICODE</span><span class="p">,</span> <span class="n">NPY_VOID</span>
<div class="newline"></div></pre></div>
</div>
</div>
<div class="section" id="solution-building-an-ufunc-from-scratch">
<h3><a class="toc-backref" href="#id13">2.2.2.3. 解答: スクラッチから ufunc を作る</a><a class="headerlink" href="#solution-building-an-ufunc-from-scratch" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># The elementwise function</span>
<div class="newline"></div><span class="c"># ------------------------</span>
<div class="newline"></div>
<div class="newline"></div><span class="n">cdef</span> <span class="n">void</span> <span class="n">mandel_single_point</span><span class="p">(</span><span class="n">double</span> <span class="nb">complex</span> <span class="o">*</span><span class="n">z_in</span><span class="p">,</span> 
<div class="newline"></div>                              <span class="n">double</span> <span class="nb">complex</span> <span class="o">*</span><span class="n">c_in</span><span class="p">,</span>
<div class="newline"></div>                              <span class="n">double</span> <span class="nb">complex</span> <span class="o">*</span><span class="n">z_out</span><span class="p">)</span> <span class="n">nogil</span><span class="p">:</span>
<div class="newline"></div>    <span class="c">#</span>
<div class="newline"></div>    <span class="c"># The Mandelbrot iteration</span>
<div class="newline"></div>    <span class="c">#</span>
<div class="newline"></div>
<div class="newline"></div>    <span class="c">#</span>
<div class="newline"></div>    <span class="c"># Some points of note:</span>
<div class="newline"></div>    <span class="c">#</span>
<div class="newline"></div>    <span class="c"># - It's *NOT* allowed to call any Python functions here.</span>
<div class="newline"></div>    <span class="c">#</span>
<div class="newline"></div>    <span class="c">#   The Ufunc loop runs with the Python Global Interpreter Lock released.</span>
<div class="newline"></div>    <span class="c">#   Hence, the ``nogil``.</span>
<div class="newline"></div>    <span class="c">#</span>
<div class="newline"></div>    <span class="c"># - And so all local variables must be declared with ``cdef``</span>
<div class="newline"></div>    <span class="c">#</span>
<div class="newline"></div>    <span class="c"># - Note also that this function receives *pointers* to the data;</span>
<div class="newline"></div>    <span class="c">#   the "traditional" solution to passing complex variables around</span>
<div class="newline"></div>    <span class="c">#</span>
<div class="newline"></div>
<div class="newline"></div>    <span class="n">cdef</span> <span class="n">double</span> <span class="nb">complex</span> <span class="n">z</span> <span class="o">=</span> <span class="n">z_in</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<div class="newline"></div>    <span class="n">cdef</span> <span class="n">double</span> <span class="nb">complex</span> <span class="n">c</span> <span class="o">=</span> <span class="n">c_in</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<div class="newline"></div>    <span class="n">cdef</span> <span class="nb">int</span> <span class="n">k</span>  <span class="c"># the integer we use in the for loop</span>
<div class="newline"></div>
<div class="newline"></div>    <span class="c"># Straightforward iteration</span>
<div class="newline"></div>
<div class="newline"></div>    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
<div class="newline"></div>        <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="o">*</span><span class="n">z</span> <span class="o">+</span> <span class="n">c</span>
<div class="newline"></div>        <span class="k">if</span> <span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">z</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
<div class="newline"></div>            <span class="k">break</span>
<div class="newline"></div>
<div class="newline"></div>    <span class="c"># Return the answer for this point</span>
<div class="newline"></div>    <span class="n">z_out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span>
<div class="newline"></div>
<div class="newline"></div>
<div class="newline"></div><span class="c"># Boilerplate Cython definitions</span>
<div class="newline"></div><span class="c">#</span>
<div class="newline"></div><span class="c"># You don't really need to read this part, it just pulls in</span>
<div class="newline"></div><span class="c"># stuff from the Numpy C headers.</span>
<div class="newline"></div><span class="c"># ----------------------------------------------------------</span>
<div class="newline"></div>
<div class="newline"></div><span class="n">cdef</span> <span class="n">extern</span> <span class="kn">from</span> <span class="s">"numpy/arrayobject.h"</span><span class="p">:</span>
<div class="newline"></div>    <span class="n">void</span> <span class="n">import_array</span><span class="p">()</span>
<div class="newline"></div>    <span class="n">ctypedef</span> <span class="nb">int</span> <span class="n">npy_intp</span>
<div class="newline"></div>    <span class="n">cdef</span> <span class="n">enum</span> <span class="n">NPY_TYPES</span><span class="p">:</span>
<div class="newline"></div>        <span class="n">NPY_CDOUBLE</span>
<div class="newline"></div>
<div class="newline"></div><span class="n">cdef</span> <span class="n">extern</span> <span class="kn">from</span> <span class="s">"numpy/ufuncobject.h"</span><span class="p">:</span>
<div class="newline"></div>    <span class="n">void</span> <span class="n">import_ufunc</span><span class="p">()</span>
<div class="newline"></div>    <span class="n">ctypedef</span> <span class="n">void</span> <span class="p">(</span><span class="o">*</span><span class="n">PyUFuncGenericFunction</span><span class="p">)(</span><span class="n">char</span><span class="o">**</span><span class="p">,</span> <span class="n">npy_intp</span><span class="o">*</span><span class="p">,</span> <span class="n">npy_intp</span><span class="o">*</span><span class="p">,</span> <span class="n">void</span><span class="o">*</span><span class="p">)</span>
<div class="newline"></div>    <span class="nb">object</span> <span class="n">PyUFunc_FromFuncAndData</span><span class="p">(</span><span class="n">PyUFuncGenericFunction</span><span class="o">*</span> <span class="n">func</span><span class="p">,</span> <span class="n">void</span><span class="o">**</span> <span class="n">data</span><span class="p">,</span>
<div class="newline"></div>        <span class="n">char</span><span class="o">*</span> <span class="n">types</span><span class="p">,</span> <span class="nb">int</span> <span class="n">ntypes</span><span class="p">,</span> <span class="nb">int</span> <span class="n">nin</span><span class="p">,</span> <span class="nb">int</span> <span class="n">nout</span><span class="p">,</span>
<div class="newline"></div>        <span class="nb">int</span> <span class="n">identity</span><span class="p">,</span> <span class="n">char</span><span class="o">*</span> <span class="n">name</span><span class="p">,</span> <span class="n">char</span><span class="o">*</span> <span class="n">doc</span><span class="p">,</span> <span class="nb">int</span> <span class="n">c</span><span class="p">)</span>
<div class="newline"></div>
<div class="newline"></div>    <span class="n">void</span> <span class="n">PyUFunc_DD_D</span><span class="p">(</span><span class="n">char</span><span class="o">**</span><span class="p">,</span> <span class="n">npy_intp</span><span class="o">*</span><span class="p">,</span> <span class="n">npy_intp</span><span class="o">*</span><span class="p">,</span> <span class="n">void</span><span class="o">*</span><span class="p">)</span>
<div class="newline"></div>
<div class="newline"></div>
<div class="newline"></div><span class="c"># Required module initialization</span>
<div class="newline"></div><span class="c"># ------------------------------</span>
<div class="newline"></div>
<div class="newline"></div><span class="n">import_array</span><span class="p">()</span>
<div class="newline"></div><span class="n">import_ufunc</span><span class="p">()</span>
<div class="newline"></div>
<div class="newline"></div>
<div class="newline"></div><span class="c"># The actual ufunc declaration</span>
<div class="newline"></div><span class="c"># ----------------------------</span>
<div class="newline"></div>
<div class="newline"></div><span class="n">cdef</span> <span class="n">PyUFuncGenericFunction</span> <span class="n">loop_func</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<div class="newline"></div><span class="n">cdef</span> <span class="n">char</span> <span class="n">input_output_types</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<div class="newline"></div><span class="n">cdef</span> <span class="n">void</span> <span class="o">*</span><span class="n">elementwise_funcs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<div class="newline"></div>
<div class="newline"></div><span class="n">loop_func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">PyUFunc_DD_D</span>
<div class="newline"></div>
<div class="newline"></div><span class="n">input_output_types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">NPY_CDOUBLE</span>
<div class="newline"></div><span class="n">input_output_types</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">NPY_CDOUBLE</span>
<div class="newline"></div><span class="n">input_output_types</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">NPY_CDOUBLE</span>
<div class="newline"></div>
<div class="newline"></div><span class="n">elementwise_funcs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">void</span><span class="o">*&gt;</span><span class="n">mandel_single_point</span>
<div class="newline"></div>
<div class="newline"></div><span class="n">mandel</span> <span class="o">=</span> <span class="n">PyUFunc_FromFuncAndData</span><span class="p">(</span>
<div class="newline"></div>    <span class="n">loop_func</span><span class="p">,</span>
<div class="newline"></div>    <span class="n">elementwise_funcs</span><span class="p">,</span>
<div class="newline"></div>    <span class="n">input_output_types</span><span class="p">,</span>
<div class="newline"></div>    <span class="mi">1</span><span class="p">,</span> <span class="c"># number of supported input types</span>
<div class="newline"></div>    <span class="mi">2</span><span class="p">,</span> <span class="c"># number of input args</span>
<div class="newline"></div>    <span class="mi">1</span><span class="p">,</span> <span class="c"># number of output args</span>
<div class="newline"></div>    <span class="mi">0</span><span class="p">,</span> <span class="c"># `identity` element, never mind this</span>
<div class="newline"></div>    <span class="s">"mandel"</span><span class="p">,</span> <span class="c"># function name</span>
<div class="newline"></div>    <span class="s">"mandel(z, c) -&gt; computes iterated z*z + c"</span><span class="p">,</span> <span class="c"># docstring</span>
<div class="newline"></div>    <span class="mi">0</span> <span class="c"># unused</span>
<div class="newline"></div>    <span class="p">)</span>
<div class="newline"></div></pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="sd">"""</span>
<div class="newline"></div><span class="sd">Plot Mandelbrot</span>
<div class="newline"></div><span class="sd">================</span>
<div class="newline"></div>
<div class="newline"></div><span class="sd">Plot the Mandelbrot ensemble.</span>
<div class="newline"></div>
<div class="newline"></div><span class="sd">"""</span>
<div class="newline"></div>
<div class="newline"></div><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<div class="newline"></div><span class="kn">import</span> <span class="nn">mandel</span>
<div class="newline"></div><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1.7</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<div class="newline"></div><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<div class="newline"></div><span class="n">c</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span> <span class="o">+</span> <span class="mi">1j</span><span class="o">*</span><span class="n">y</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span>
<div class="newline"></div><span class="n">z</span> <span class="o">=</span> <span class="n">mandel</span><span class="o">.</span><span class="n">mandel</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<div class="newline"></div>
<div class="newline"></div><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<div class="newline"></div><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">1.7</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">])</span>
<div class="newline"></div><span class="n">plt</span><span class="o">.</span><span class="n">gray</span><span class="p">()</span>
<div class="newline"></div><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<div class="newline"></div></pre></div>
</div>
<img alt="../../_images/mandelbrot.png" src="2.2.%20Numpy%20%E3%81%AE%E5%85%88%E9%80%B2%E7%9A%84%E3%81%AA%E6%A9%9F%E8%83%BD%20%E2%80%94%20Scipy%20lecture%20notes_files/mandelbrot.png">
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p>ほとんどのボイラーテンプレートはこれらの Cython モジュールで自動化できます:</p>
<p class="last"><a class="reference external" href="http://wiki.cython.org/MarkLodato/CreatingUfuncs">http://wiki.cython.org/MarkLodato/CreatingUfuncs</a></p>
</div>
<p class="rubric">いくつかの入力型を許容する</p>
<p>例として単精度と倍精度の両方をサポートする場合</p>
<div class="highlight-c"><div class="highlight"><pre>cdef void mandel_single_point(double complex *z_in,
<div class="newline"></div>                              double complex *c_in,
<div class="newline"></div>                              double complex *z_out) nogil:
<div class="newline"></div>   ...
<div class="newline"></div>
<div class="newline"></div>cdef void mandel_single_point_singleprec(float complex *z_in,
<div class="newline"></div>                                         float complex *c_in,
<div class="newline"></div>                                         float complex *z_out) nogil:
<div class="newline"></div>   ...
<div class="newline"></div>
<div class="newline"></div>cdef PyUFuncGenericFunction loop_funcs[2]
<div class="newline"></div>cdef char input_output_types[3*2]
<div class="newline"></div>cdef void *elementwise_funcs[1*2]
<div class="newline"></div>
<div class="newline"></div>loop_funcs[0] = PyUFunc_DD_D
<div class="newline"></div>input_output_types[0] = NPY_CDOUBLE
<div class="newline"></div>input_output_types[1] = NPY_CDOUBLE
<div class="newline"></div>input_output_types[2] = NPY_CDOUBLE
<div class="newline"></div>elementwise_funcs[0] = &lt;void*&gt;mandel_single_point
<div class="newline"></div>
<div class="newline"></div>loop_funcs[1] = PyUFunc_FF_F
<div class="newline"></div>input_output_types[3] = NPY_CFLOAT
<div class="newline"></div>input_output_types[4] = NPY_CFLOAT
<div class="newline"></div>input_output_types[5] = NPY_CFLOAT
<div class="newline"></div>elementwise_funcs[1] = &lt;void*&gt;mandel_single_point_singleprec
<div class="newline"></div>
<div class="newline"></div>mandel = PyUFunc_FromFuncAndData(
<div class="newline"></div>    loop_func,
<div class="newline"></div>    elementwise_funcs,
<div class="newline"></div>    input_output_types,
<div class="newline"></div>    2, # number of supported input types   &lt;----------------
<div class="newline"></div>    2, # number of input args
<div class="newline"></div>    1, # number of output args
<div class="newline"></div>    0, # `identity` element, never mind this
<div class="newline"></div>    "mandel", # function name
<div class="newline"></div>    "mandel(z, c) -&gt; computes iterated z*z + c", # docstring
<div class="newline"></div>    0 # unused
<div class="newline"></div>    )
<div class="newline"></div></pre></div>
</div>
</div>
<div class="section" id="generalized-ufuncs">
<h3><a class="toc-backref" href="#id14">2.2.2.4. 一般化された ufunc</a><a class="headerlink" href="#generalized-ufuncs" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><strong>ufunc</strong></p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">output</span> <span class="pre">=</span> <span class="pre">elementwise_function(input)</span></code></p>
<p><code class="docutils literal"><span class="pre">output</span></code> と <code class="docutils literal"><span class="pre">input</span></code> の両者は単一の配列要素のみ。</p>
</div></blockquote>
<p><strong>一般化された ufunc</strong></p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">output</span></code> と <code class="docutils literal"><span class="pre">input</span></code> が固定長次元の配列でもいい</p>
<p>例として、行列のトレース (対角要素の和):</p>
<div class="highlight-python"><div class="highlight"><pre>input shape = (n, n)
<div class="newline"></div>output shape = ()      i.e.  scalar
<div class="newline"></div>
<div class="newline"></div>(n, n) -&gt; ()
<div class="newline"></div></pre></div>
</div>
<p>行列積:</p>
<div class="highlight-python"><div class="highlight"><pre>input_1 shape = (m, n)
<div class="newline"></div>input_2 shape = (n, p)
<div class="newline"></div>output shape  = (m, p)
<div class="newline"></div>
<div class="newline"></div>(m, n), (n, p) -&gt; (m, p)
<div class="newline"></div></pre></div>
</div>
<ul class="simple">
<li><p class="first">これは一般化された ufunc の <em>“signature”</em> と呼ばれます</p>
</li>
<li><p class="first">g-ufunc が動作する次元は <em>“core dimensions”</em></p>
</li>
</ul>
</div></blockquote>
<p class="rubric">Numpy での状況</p>
<ul class="simple">
<li><p class="first">g-ufunc は Numpy では十分といえますが...</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">PyUFunc_FromFuncAndDataAndSignature</span></code> で新しいものが作れます</p>
</li>
<li><p class="first">...が、g-ufunc は今のところテスト無しで公開することはできません、今のところは</p>
</li>
</ul>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy.core.umath_tests</span> <span class="kn">as</span> <span class="nn">ut</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">matrix_multiply</span><span class="o">.</span><span class="n">signature</span>
<div class="newline"></div><span class="go">'(m,n),(n,p)-&gt;(m,p)'</span>
<div class="newline"></div></pre></div>
</div>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">matrix_multiply</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
<div class="newline"></div><span class="go">(10, 2, 5)</span>
<div class="newline"></div></pre></div>
</div>
<ul class="simple">
<li><p class="first">最後の2つの次元が <em>core dimensions</em> で <em>signature</em> 毎に変更されます</p>
</li>
<li><p class="first">それ以外の場合は、g-ufunc は「要素毎」に演算します</p>
</li>
<li><p class="first">行列の乗算をこの方法でやると、小さな行列を一度に演算する必要がある場合に便利です。</p>
</li>
</ul>
<p class="rubric">一般化された ufunc のループ</p>
<p>行列の乗算 <code class="docutils literal"><span class="pre">(m,n),(n,p)</span> <span class="pre">-&gt;</span> <span class="pre">(m,p)</span></code></p>
<div class="highlight-c"><div class="highlight"><pre><span class="kt">void</span> <span class="nf">gufunc_loop</span><span class="p">(</span><span class="kt">void</span> <span class="o">**</span><span class="n">args</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">dimensions</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">steps</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<div class="newline"></div><span class="p">{</span>
<div class="newline"></div>    <span class="kt">char</span> <span class="o">*</span><span class="n">input_1</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>  <span class="cm">/* these are as previously */</span>
<div class="newline"></div>    <span class="kt">char</span> <span class="o">*</span><span class="n">input_2</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<div class="newline"></div>    <span class="kt">char</span> <span class="o">*</span><span class="n">output</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<div class="newline"></div>
<div class="newline"></div>    <span class="kt">int</span> <span class="n">input_1_stride_m</span> <span class="o">=</span> <span class="n">steps</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>  <span class="cm">/* strides for the core dimensions */</span>
<div class="newline"></div>    <span class="kt">int</span> <span class="n">input_1_stride_n</span> <span class="o">=</span> <span class="n">steps</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>  <span class="cm">/* are added after the non-core */</span>
<div class="newline"></div>    <span class="kt">int</span> <span class="n">input_2_strides_n</span> <span class="o">=</span> <span class="n">steps</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span> <span class="cm">/* steps */</span>
<div class="newline"></div>    <span class="kt">int</span> <span class="n">input_2_strides_p</span> <span class="o">=</span> <span class="n">steps</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
<div class="newline"></div>    <span class="kt">int</span> <span class="n">output_strides_n</span> <span class="o">=</span> <span class="n">steps</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
<div class="newline"></div>    <span class="kt">int</span> <span class="n">output_strides_p</span> <span class="o">=</span> <span class="n">steps</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<div class="newline"></div>
<div class="newline"></div>    <span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="n">dimension</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="cm">/* core dimensions are added after */</span>
<div class="newline"></div>    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">dimension</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="cm">/* the main dimension; order as in */</span>
<div class="newline"></div>    <span class="kt">int</span> <span class="n">p</span> <span class="o">=</span> <span class="n">dimension</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span> <span class="cm">/* signature */</span>
<div class="newline"></div>
<div class="newline"></div>    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<div class="newline"></div>
<div class="newline"></div>    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
<div class="newline"></div>        <span class="n">matmul_for_strided_matrices</span><span class="p">(</span><span class="n">input_1</span><span class="p">,</span> <span class="n">input_2</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span>
<div class="newline"></div>                                    <span class="n">strides</span> <span class="k">for</span> <span class="n">each</span> <span class="n">array</span><span class="p">...);</span>
<div class="newline"></div>
<div class="newline"></div>        <span class="n">input_1</span> <span class="o">+=</span> <span class="n">steps</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<div class="newline"></div>        <span class="n">input_2</span> <span class="o">+=</span> <span class="n">steps</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<div class="newline"></div>        <span class="n">output</span> <span class="o">+=</span> <span class="n">steps</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<div class="newline"></div>    <span class="p">}</span>
<div class="newline"></div><span class="p">}</span>
<div class="newline"></div></pre></div>
</div>
</div>
</div>
<div class="section" id="interoperability-features">
<h2><a class="toc-backref" href="#id15">2.2.3. 相互運用のための機能</a><a class="headerlink" href="#interoperability-features" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="sharing-multidimensional-typed-data">
<h3><a class="toc-backref" href="#id16">2.2.3.1. 多次元の型つきデータを共有する</a><a class="headerlink" href="#sharing-multidimensional-typed-data" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>以下のことがだと仮定します</p>
<ol class="arabic simple">
<li><p class="first">(多次元の) バイナリデータを扱うのではなく、ライブラリを書く、</p>
</li>
<li><p class="first">Numpy または他のライブラリなどでデータを簡単に操作できるようにしたい</p>
</li>
<li><p class="first">... が、Numpy に依存として持ち <em>たくない</em>。</p>
</li>
</ol>
<p>今のところ 3つの解決策があります:</p>
<ol class="arabic simple">
<li><p class="first">「古い」buffer インターフェース</p>
</li>
<li><p class="first">array インターフェース</p>
</li>
<li><p class="first">「新しい」buffer インターフェース (<span class="target" id="index-2"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3118"><strong>PEP 3118</strong></a>)</p>
</li>
</ol>
</div>
<div class="section" id="the-old-buffer-protocol">
<h3><a class="toc-backref" href="#id17">2.2.3.2. 古い buffer プロトコル</a><a class="headerlink" href="#the-old-buffer-protocol" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul class="simple">
<li><p class="first">1次元 buffer のみ</p>
</li>
<li><p class="first">データ型情報なし</p>
</li>
<li><p class="first">Cレベルのインターフェース; 型オブジェクト内の <code class="docutils literal"><span class="pre">PyBufferProcs</span> <span class="pre">tp_as_buffer</span></code></p>
</li>
<li><p class="first">ですが、Python 内に統合されています (例えば、文字列はこれをサポートします。)</p>
</li>
</ul>
<p><a class="reference external" href="https://python-pillow.github.io/">Pillow</a> (Python 画像ライブラリ) を利用した小演習:</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last">pilbuffer.py</p>
</div>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">]</span> <span class="c"># Red</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="c"># In PIL, RGBA images consist of 32-bit integers whose bytes are [RR,GG,BB,AA]</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="s">"RGBA"</span><span class="p">,</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="n">data</span><span class="p">,</span> <span class="s">"raw"</span><span class="p">,</span> <span class="s">"RGBA"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s">'test.png'</span><span class="p">)</span>
<div class="newline"></div></pre></div>
</div>
<p><strong>質問:</strong></p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">data</span></code> を変更して <code class="docutils literal"><span class="pre">img</span></code> を再度保存すると、何が起きるか確認してましょう。</p>
</div></blockquote>
</div>
<div class="section" id="id3">
<h3><a class="toc-backref" href="#id18">2.2.3.3. 古い buffer プロトコル</a><a class="headerlink" href="#id3" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="sd">"""</span>
<div class="newline"></div><span class="sd">From buffer</span>
<div class="newline"></div><span class="sd">============</span>
<div class="newline"></div>
<div class="newline"></div><span class="sd">Show how to exchange data between numpy and a library that only knows</span>
<div class="newline"></div><span class="sd">the buffer interface.</span>
<div class="newline"></div><span class="sd">"""</span>
<div class="newline"></div>
<div class="newline"></div><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<div class="newline"></div><span class="kn">import</span> <span class="nn">Image</span>
<div class="newline"></div>
<div class="newline"></div><span class="c"># Let's make a sample image, RGBA format</span>
<div class="newline"></div>
<div class="newline"></div><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
<div class="newline"></div>
<div class="newline"></div><span class="n">x</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">254</span> <span class="c"># red</span>
<div class="newline"></div><span class="n">x</span><span class="p">[:,:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span> <span class="c"># opaque</span>
<div class="newline"></div>
<div class="newline"></div><span class="n">data</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span> <span class="c"># Check that you understand why this is OK!</span>
<div class="newline"></div>
<div class="newline"></div><span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="s">"RGBA"</span><span class="p">,</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<div class="newline"></div><span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s">'test.png'</span><span class="p">)</span>
<div class="newline"></div>
<div class="newline"></div><span class="c">#</span>
<div class="newline"></div><span class="c"># Modify the original data, and save again.</span>
<div class="newline"></div><span class="c">#</span>
<div class="newline"></div><span class="c"># It turns out that PIL, which knows next to nothing about Numpy,</span>
<div class="newline"></div><span class="c"># happily shares the same data.</span>
<div class="newline"></div><span class="c">#</span>
<div class="newline"></div>
<div class="newline"></div><span class="n">x</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">254</span>
<div class="newline"></div><span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s">'test2.png'</span><span class="p">)</span>
<div class="newline"></div></pre></div>
</div>
<img alt="../../_images/test.png" src="2.2.%20Numpy%20%E3%81%AE%E5%85%88%E9%80%B2%E7%9A%84%E3%81%AA%E6%A9%9F%E8%83%BD%20%E2%80%94%20Scipy%20lecture%20notes_files/test.png">
<img alt="../../_images/test2.png" src="2.2.%20Numpy%20%E3%81%AE%E5%85%88%E9%80%B2%E7%9A%84%E3%81%AA%E6%A9%9F%E8%83%BD%20%E2%80%94%20Scipy%20lecture%20notes_files/test2.png">
</div>
<div class="section" id="array-interface-protocol">
<h3><a class="toc-backref" href="#id19">2.2.3.4. Array インターフェースプロトコル</a><a class="headerlink" href="#array-interface-protocol" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul class="simple">
<li><p class="first">多次元のバッファ</p>
</li>
<li><p class="first">データ型情報が存在する</p>
</li>
<li><p class="first">Numpy 特有の方法: ゆるやかに非推奨になっています (完全にではありませんが)</p>
</li>
<li><p class="first">いづれにせよ Python には統合されません。</p>
</li>
</ul>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last">ドキュメント: <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/arrays.interface.html">http://docs.scipy.org/doc/numpy/reference/arrays.interface.html</a></p>
</div>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">__array_interface__</span>   
<div class="newline"></div><span class="go">{'data': (171694552, False),      # memory address of data, is readonly?</span>
<div class="newline"></div><span class="go"> 'descr': [('', '&lt;i4')],          # data type descriptor</span>
<div class="newline"></div><span class="go"> 'typestr': '&lt;i4',                # same, in another form</span>
<div class="newline"></div><span class="go"> 'strides': None,                 # strides; or None if in C-order</span>
<div class="newline"></div><span class="go"> 'shape': (2, 2),</span>
<div class="newline"></div><span class="go"> 'version': 3,</span>
<div class="newline"></div><span class="go">}</span>
<div class="newline"></div></pre></div>
</div>
<dl class="docutils">
<dt>::</dt>
<dd><div style="position: relative;" class="first last highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">'data/test.png'</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">img</span><span class="o">.</span><span class="n">__array_interface__</span>     
<div class="newline"></div><span class="go">{'data': ...,</span>
<div class="newline"></div><span class="go"> 'shape': (200, 200, 4),</span>
<div class="newline"></div><span class="go"> 'typestr': '|u1'}</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">shape</span>
<div class="newline"></div><span class="go">(200, 200, 4)</span>
<div class="newline"></div></pre></div>
</div>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">より C フレンドリーな array インターフェースの変種も定義されています。</p>
</div>
</div>
</div>
<div class="section" id="array-siblings-chararray-maskedarray-matrix">
<span id="array-siblings"></span><h2><a class="toc-backref" href="#id20">2.2.4. 配列の競合: <code class="xref py py-class docutils literal"><span class="pre">chararray</span></code>, <code class="xref py py-class docutils literal"><span class="pre">maskedarray</span></code>, <code class="xref py py-class docutils literal"><span class="pre">matrix</span></code></a><a class="headerlink" href="#array-siblings-chararray-maskedarray-matrix" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="chararray-vectorized-string-operations">
<h3><a class="toc-backref" href="#id21">2.2.4.1. <code class="xref py py-class docutils literal"><span class="pre">chararray</span></code>: 文字列演算のベクトル化</a><a class="headerlink" href="#chararray-vectorized-string-operations" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s">'a'</span><span class="p">,</span> <span class="s">'  bbb'</span><span class="p">,</span> <span class="s">'  ccc'</span><span class="p">])</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">chararray</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">' '</span><span class="p">)</span>       
<div class="newline"></div><span class="go">chararray(['a', 'bbb', 'ccc'],</span>
<div class="newline"></div><span class="go">      dtype='...')</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>       
<div class="newline"></div><span class="go">chararray(['A', '  BBB', '  CCC'],</span>
<div class="newline"></div><span class="go">      dtype='...')</span>
<div class="newline"></div></pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">ここでの <code class="docutils literal"><span class="pre">.view()</span></code> は別の意味を持ちます: 特殊化した ndarray 派生クラスのインスタンスの ndarray を作成できます</p>
</div>
</div>
<div class="section" id="masked-array-missing-data">
<h3><a class="toc-backref" href="#id22">2.2.4.2. <code class="xref py py-class docutils literal"><span class="pre">masked_array</span></code> 欠損データ</a><a class="headerlink" href="#masked-array-missing-data" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>マスクされた配列は欠損値や無効な内容を含む場合があります。</p>
<p>例えば、4つめの値が無効な配列を考えてみましょう:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">99</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<div class="newline"></div></pre></div>
</div>
<p>これを記述するために、マスクされた配列を利用します:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">mx</span>
<div class="newline"></div><span class="go">masked_array(data = [1 2 3 -- 5],</span>
<div class="newline"></div><span class="go">             mask = [False False False  True False],</span>
<div class="newline"></div><span class="go">       fill_value = 999999)</span>
<div class="newline"></div></pre></div>
</div>
<p>マスクされた、という意味はマスクしたデータを無視することからきています。</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mx</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<div class="newline"></div><span class="go">2.75</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mx</span><span class="p">)</span>
<div class="newline"></div><span class="go">2.75</span>
<div class="newline"></div></pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">全ての Numpy 関数がマスクを扱えるわけではありません、例えば <code class="docutils literal"><span class="pre">np.dot</span></code> など、なので返ってくる型を確認しましょう。</p>
</div>
<p><code class="docutils literal"><span class="pre">masked_array</span></code> は元の配列の <strong>ビュー</strong> を返します:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>
<div class="newline"></div><span class="go">array([  1,   9,   3, -99,   5])</span>
<div class="newline"></div></pre></div>
</div>
<div class="section" id="the-mask">
<h4>2.2.4.2.1. マスク<a class="headerlink" href="#the-mask" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>マスクを代入で変更することもできます:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">mx</span>
<div class="newline"></div><span class="go">masked_array(data = [1 -- 3 -- 5],</span>
<div class="newline"></div><span class="go">             mask = [False  True False  True False],</span>
<div class="newline"></div><span class="go">       fill_value = 999999)</span>
<div class="newline"></div></pre></div>
</div>
<p>マスクは代入により消せます:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">mx</span>
<div class="newline"></div><span class="go">masked_array(data = [1 9 3 -- 5],</span>
<div class="newline"></div><span class="go">             mask = [False False False  True False],</span>
<div class="newline"></div><span class="go">       fill_value = 999999)</span>
<div class="newline"></div></pre></div>
</div>
<p>マスクを直接利用することもできます:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mx</span><span class="o">.</span><span class="n">mask</span>
<div class="newline"></div><span class="go">array([False, False, False,  True, False], dtype=bool)</span>
<div class="newline"></div></pre></div>
</div>
<p>マスクされた内容は値を与えて埋めることで、通常の配列に戻すこともできます:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x2</span> <span class="o">=</span> <span class="n">mx</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x2</span>
<div class="newline"></div><span class="go">array([ 1,  9,  3, -1,  5])</span>
<div class="newline"></div></pre></div>
</div>
<p>マスクも消すことができます:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mx</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">nomask</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">mx</span>
<div class="newline"></div><span class="go">masked_array(data = [1 9 3 -99 5],</span>
<div class="newline"></div><span class="go">             mask = [False False False False False],</span>
<div class="newline"></div><span class="go">       fill_value = 999999)</span>
<div class="newline"></div></pre></div>
</div>
</div>
<div class="section" id="domain-aware-functions">
<h4>2.2.4.2.2. 領域を配慮する関数<a class="headerlink" href="#domain-aware-functions" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>masked array パッケージには領域を配慮する関数も含まれています:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">]))</span>
<div class="newline"></div><span class="go">masked_array(data = [0.0 0.6931471805599453 -- -- 1.0986122886681098 --],</span>
<div class="newline"></div><span class="go">             mask = [False False  True  True False  True],</span>
<div class="newline"></div><span class="go">       fill_value = 1e+20)</span>
<div class="newline"></div></pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">欠損データが含まれる配列を扱うための効率的で自然なサポートが Numpy 1.7 で進められています。乞うご期待!</p>
</div>
<div class="topic">
<p class="topic-title first">例: 統計でマスクを利用する</p>
<p>カナダのレンジャーは 1903年-1910年と1917年-1918年の間で野ウサギと山猫の計数するときに気をとられて、間違った数字を出しました。(しかし、ニンジン農家は注意深いままでした。)個体数の時間変化を、無効な数値を除いて計算します。</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">'data/populations.txt'</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">populations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">year</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<div class="newline"></div>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">bad_years</span> <span class="o">=</span> <span class="p">(((</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1903</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">1910</span><span class="p">))</span>
<div class="newline"></div><span class="gp">... </span>           <span class="o">|</span> <span class="p">((</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1917</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">1918</span><span class="p">)))</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="c"># '&amp;' means 'and' and '|' means 'or'</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">populations</span><span class="p">[</span><span class="n">bad_years</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">populations</span><span class="p">[</span><span class="n">bad_years</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked</span>
<div class="newline"></div>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">populations</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<div class="newline"></div><span class="go">masked_array(data = [40472.72727272727 18627.272727272728 42400.0],</span>
<div class="newline"></div><span class="go">             mask = [False False False],</span>
<div class="newline"></div><span class="go">       fill_value = 1e+20)</span>
<div class="newline"></div>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">populations</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<div class="newline"></div><span class="go">masked_array(data = [21087.656489006717 15625.799814240254 3322.5062255844787],</span>
<div class="newline"></div><span class="go">             mask = [False False False],</span>
<div class="newline"></div><span class="go">       fill_value = 1e+20)</span>
<div class="newline"></div></pre></div>
</div>
<p>Matplotlib はマスクされた配列のことを知っていることに注意をしておきましょう:</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">populations</span><span class="p">,</span> <span class="s">'o-'</span><span class="p">)</span>   
<div class="newline"></div><span class="go">[&lt;matplotlib.lines.Line2D object at ...&gt;, ...]</span>
<div class="newline"></div></pre></div>
</div>
<p>[<a class="reference external" href="http://www.turbare.net/transl/scipy-lecture-notes/plot_directive/pyplots/numpy_intro_8.py">ソースコード</a>, <a class="reference external" href="http://www.turbare.net/transl/scipy-lecture-notes/plot_directive/pyplots/numpy_intro_8.hires.png">hires.png</a>, <a class="reference external" href="http://www.turbare.net/transl/scipy-lecture-notes/plot_directive/pyplots/numpy_intro_8.pdf">pdf</a>]</p>
<img alt="../../_images/numpy_intro_8.png" src="2.2.%20Numpy%20%E3%81%AE%E5%85%88%E9%80%B2%E7%9A%84%E3%81%AA%E6%A9%9F%E8%83%BD%20%E2%80%94%20Scipy%20lecture%20notes_files/numpy_intro_8.png">
</div>
</div>
</div>
<div class="section" id="recarray-purely-convenience">
<h3><a class="toc-backref" href="#id23">2.2.4.3. <code class="xref py py-class docutils literal"><span class="pre">recarray</span></code>: 純粋に便利</a><a class="headerlink" href="#recarray-purely-convenience" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="s">'a'</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s">'b'</span><span class="p">,</span> <span class="mi">2</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s">'x'</span><span class="p">,</span> <span class="s">'S1'</span><span class="p">),</span> <span class="p">(</span><span class="s">'y'</span><span class="p">,</span> <span class="nb">int</span><span class="p">)])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">arr2</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">recarray</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">arr2</span><span class="o">.</span><span class="n">x</span>       
<div class="newline"></div><span class="go">chararray(['a', 'b'],</span>
<div class="newline"></div><span class="go">      dtype='|S1')</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">arr2</span><span class="o">.</span><span class="n">y</span>
<div class="newline"></div><span class="go">array([1, 2])</span>
<div class="newline"></div></pre></div>
</div>
</div>
<div class="section" id="matrix-convenience">
<h3><a class="toc-backref" href="#id24">2.2.4.4. <code class="xref py py-class docutils literal"><span class="pre">matrix</span></code>: は便利なの?</a><a class="headerlink" href="#matrix-convenience" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul class="simple">
<li><p class="first">常に2次元</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">*</span></code> は行列積で、要素毎ではない</p>
</li>
</ul>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
<div class="newline"></div><span class="go">matrix([[1, 2],</span>
<div class="newline"></div><span class="go">        [3, 4]])</span>
<div class="newline"></div></pre></div>
</div>
</div>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id25">2.2.5. まとめ</a><a class="headerlink" href="#summary" title="このヘッドラインへのパーマリンク">¶</a></h2>
<ul class="simple">
<li><p class="first">ndarray の解剖: data, dtype, strides.</p>
</li>
<li><p class="first">ユニバーサル関数: 要素毎の演算と新しいものをどうやって作るか</p>
</li>
<li><p class="first">ndarray の派生クラス</p>
</li>
<li><p class="first">他のツールとの統合のための多様な buffer インターフェース</p>
</li>
<li><p class="first">最近追加されたもの: PEP 3118 や一般化された ufunc</p>
</li>
</ul>
</div>
<div class="section" id="contributing-to-numpy-scipy">
<h2><a class="toc-backref" href="#id26">2.2.6. Numpy/Scipy に貢献するには</a><a class="headerlink" href="#contributing-to-numpy-scipy" title="このヘッドラインへのパーマリンク">¶</a></h2>
<blockquote>
<div><p>このチュートリアルを見ましょう: <a class="reference external" href="http://www.euroscipy.org/talk/882">http://www.euroscipy.org/talk/882</a></p>
</div></blockquote>
<div class="section" id="why">
<h3><a class="toc-backref" href="#id27">2.2.6.1. なぜ</a><a class="headerlink" href="#why" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul class="simple">
<li><p class="first">「これバグ?」</p>
</li>
<li><p class="first">「なんでこういう動きをするのか理解できない」</p>
</li>
<li><p class="first">「こんなすごいコードがあるんだけど、どう?」</p>
</li>
<li><p class="first">「支援したい!何かできることある?」</p>
</li>
</ul>
</div>
<div class="section" id="reporting-bugs">
<h3><a class="toc-backref" href="#id28">2.2.6.2. バグレポート</a><a class="headerlink" href="#reporting-bugs" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul class="simple">
<li><p class="first">バグトラッカー(<strong>ここ</strong> を使うのがいい)</p>
<ul>
<li><a class="reference external" href="http://projects.scipy.org/numpy">http://projects.scipy.org/numpy</a></li>
<li><a class="reference external" href="http://projects.scipy.org/scipy">http://projects.scipy.org/scipy</a></li>
<li><p class="first">“Register” リンクをクリックして、アカウントを取得しましょう</p>
</li>
</ul>
</li>
<li><p class="first">メーリングリスト (scipy.org/Mailing_Lists)</p>
<ul>
<li><p class="first">確実にバグかわからない場合に</p>
</li>
<li><p class="first">1週間くらい返信がない? バグチケットを提出しましょう。</p>
</li>
</ul>
</li>
</ul>
<div class="section" id="good-bug-report">
<h4>2.2.6.2.1. 良いバグレポート<a class="headerlink" href="#good-bug-report" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-python"><div class="highlight"><pre>Title: numpy.random.permutations fails for non-integer arguments
<div class="newline"></div>
<div class="newline"></div>I'm trying to generate random permutations, using numpy.random.permutations
<div class="newline"></div>
<div class="newline"></div>When calling numpy.random.permutation with non-integer arguments
<div class="newline"></div>it fails with a cryptic error message::
<div class="newline"></div>
<div class="newline"></div>    &gt;&gt;&gt; np.random.permutation(12)
<div class="newline"></div>    array([ 6, 11,  4, 10,  2,  8,  1,  7,  9,  3,  0,  5])
<div class="newline"></div>    &gt;&gt;&gt; np.random.permutation(12.)
<div class="newline"></div>    Traceback (most recent call last):
<div class="newline"></div>      File "&lt;stdin&gt;", line 1, in &lt;module&gt;
<div class="newline"></div>      File "mtrand.pyx", line 3311, in mtrand.RandomState.permutation
<div class="newline"></div>      File "mtrand.pyx", line 3254, in mtrand.RandomState.shuffle
<div class="newline"></div>    TypeError: len() of unsized object
<div class="newline"></div>
<div class="newline"></div>This also happens with long arguments, and so
<div class="newline"></div>np.random.permutation(X.shape[0]) where X is an array fails on 64
<div class="newline"></div>bit windows (where shape is a tuple of longs).
<div class="newline"></div>
<div class="newline"></div>It would be great if it could cast to integer or at least raise a
<div class="newline"></div>proper error for non-integer types.
<div class="newline"></div>
<div class="newline"></div>I'm using Numpy 1.4.1, built from the official tarball, on Windows
<div class="newline"></div>64 with Visual studio 2008, on Python.org 64-bit Python.
<div class="newline"></div></pre></div>
</div>
<ol class="arabic" start="0">
<li><p class="first">何をしたいかを明らかにしましょう</p>
</li>
<li><p class="first"><strong>バグを再現する小さなコードスニペット</strong> (可能であれば)</p>
<ul class="simple">
<li><p class="first">実際に何が起きているのか</p>
</li>
<li><p class="first">あなたが期待すること</p>
</li>
</ul>
</li>
<li><p class="first">プラットフォーム (Windows / Linux / OSX, 32/64ビット, x86/PPC, ...)</p>
</li>
<li><p class="first">Numpy/Scipy のバージョン</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> 
<div class="newline"></div><span class="go">1...</span>
<div class="newline"></div></pre></div>
</div>
<p><strong>以下の結果が期待通りか確認しましょう</strong></p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><span button_hint="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(184, 190, 195); border-style: none; border-width: 0px; color: rgb(184, 190, 195); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; display: none; text-decoration: none;" class="copybutton">&gt;&gt;&gt;</span><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">__file__</span><span class="p">)</span> 
<div class="newline"></div><span class="go">/...</span>
<div class="newline"></div></pre></div>
</div>
<p>もし、古いあるいは壊れた Numpy がインストールされている場所の場合。</p>
<p>もし、よくわからない場合はインストールされた Numpy を削除して再インストールするなど...</p>
</li>
</ol>
</div>
</div>
<div class="section" id="contributing-to-documentation">
<h3><a class="toc-backref" href="#id29">2.2.6.3. ドキュメントへの貢献</a><a class="headerlink" href="#contributing-to-documentation" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ol class="arabic">
<li><p class="first">ドキュメントエディタ</p>
<ul>
<li><p class="first"><a class="reference external" href="http://docs.scipy.org/doc/numpy">http://docs.scipy.org/doc/numpy</a></p>
</li>
<li><p class="first">登録</p>
<ul>
<li><p class="first">アカウントの登録</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">scipy-dev</span></code> メーリングリストへの登録 (購読のみ)</p>
</li>
<li><p class="first">メーリングリストの問題: メール受信</p>
<ul>
<li><p class="first">しかし: <strong>メール配送を切ることもできます</strong></p>
</li>
<li><p class="first">下部の “change your subscription options”</p>
<p><a class="reference external" href="http://mail.scipy.org/mailman/listinfo/scipy-dev">http://mail.scipy.org/mailman/listinfo/scipy-dev</a></p>
</li>
</ul>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">scipy-dev</span></code> メーリングリストにメールを送り、アクティベーションをお願いします:</p>
<div class="highlight-python"><div class="highlight"><pre>To: scipy-dev@scipy.org
<div class="newline"></div>
<div class="newline"></div>Hi,
<div class="newline"></div>
<div class="newline"></div>I'd like to edit Numpy/Scipy docstrings. My account is XXXXX
<div class="newline"></div>
<div class="newline"></div>Cheers,
<div class="newline"></div>N. N.
<div class="newline"></div></pre></div>
</div>
</li>
</ul>
</li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p class="first">スタイルガイドを確認します:</p>
<ul>
<li><a class="reference external" href="http://docs.scipy.org/doc/numpy/">http://docs.scipy.org/doc/numpy/</a></li>
<li><p class="first">恐れず; 小さい修正なら、単に修正するだけです</p>
</li>
</ul>
</li>
<li><p class="first">編集する</p>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">ソースを編集したり、(バグに対する)パッチを送る</p>
</li>
<li><p class="first">メーリングリストで訴えかける</p>
</li>
</ol>
</div>
<div class="section" id="contributing-features">
<h3><a class="toc-backref" href="#id30">2.2.6.4. 機能の貢献</a><a class="headerlink" href="#contributing-features" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ol class="arabic" start="0">
<li><p class="first">やるべきことか判断しかねる場合は、メーリングリストで尋ねてみましょう</p>
</li>
<li><p class="first">パッチを書いて、enhancement チケットをバグトラッカーに追加します</p>
</li>
<li><p class="first">あるいは、機能を実装する Git ブランチを作成し、加えて enhancement ticket を追加します。</p>
<ul class="simple">
<li><p class="first">特に大規模だったり、内部をかなり変更するような追加の場合は</p>
</li>
<li><a class="reference external" href="http://projects.scipy.org/numpy/wiki/GitMirror">http://projects.scipy.org/numpy/wiki/GitMirror</a></li>
<li><a class="reference external" href="http://www.spheredev.org/wiki/Git_for_the_lazy">http://www.spheredev.org/wiki/Git_for_the_lazy</a></li>
</ul>
<div class="highlight-python"><div class="highlight"><pre># Clone numpy repository
<div class="newline"></div>git clone --origin svn http://projects.scipy.org/git/numpy.git numpy
<div class="newline"></div>cd numpy
<div class="newline"></div>
<div class="newline"></div># Create a feature branch
<div class="newline"></div>git checkout -b name-of-my-feature-branch  svn/trunk
<div class="newline"></div>
<div class="newline"></div>&lt;edit stuff&gt;
<div class="newline"></div>
<div class="newline"></div>git commit -a
<div class="newline"></div></pre></div>
</div>
<ul class="simple">
<li><p class="first"><a class="reference external" href="https://github.com/">https://github.com</a>  (または他のものでも) でアカウントを作成する</p>
</li>
<li><p class="first">Github で新しいリポジトリを作成する</p>
</li>
<li><p class="first">github にやった内容を push する</p>
</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>git remote add github git@github:USERNAME/REPOSITORYNAME.git
<div class="newline"></div>git push github name-of-my-feature-branch
<div class="newline"></div></pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="how-to-help-in-general">
<h3><a class="toc-backref" href="#id31">2.2.6.5. 一般的な支援をするには</a><a class="headerlink" href="#how-to-help-in-general" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul>
<li><p class="first">バグ修正は常に歓迎します!</p>
<ul class="simple">
<li><p class="first">一番あなたをいらいらさせるもの</p>
</li>
<li><p class="first">トラッカーを眺めてみましょう</p>
</li>
</ul>
</li>
<li><p class="first">ドキュメントでの貢献</p>
<ul>
<li><p class="first">API ドキュメント: ドキュメンテーション文字列の改善</p>
<ul class="simple">
<li><p class="first">いくつかの Scipy モジュールについて十分な知識がありますか?</p>
</li>
</ul>
</li>
<li><p class="first"><em>ユーザガイド</em></p>
<ul>
<li><p class="first">ゆくゆくはやっていく必要があります。</p>
</li>
<li><p class="first">考えてみますか? 目次から考えてみましょう</p>
<p><a class="reference external" href="http://scipy.org/Developer_Zone/UG_Toc">http://scipy.org/Developer_Zone/UG_Toc</a></p>
</li>
</ul>
</li>
</ul>
</li>
<li><p class="first">コミュニケーションチャンネルでの質問</p>
<ul class="simple">
<li><p class="first"><code class="docutils literal"><span class="pre">numpy-discussion</span></code> メーリングリスト</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">scipy-dev</span></code> メーリングリスト</p>
</li>
</ul>
</li>
</ul>
<p></p><div style="clear: both"></div><p></p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
	<div class="sidebartoc active">
  <h3><a href="http://www.turbare.net/transl/scipy-lecture-notes/index.html">目次</a></h3>
  <ul>
<li class="active"><a class="reference internal" href="#">2.2. Numpy の先進的な機能</a><ul>
<li class="active"><a class="reference internal" href="#life-of-ndarray">2.2.1. ndarray の生態</a><ul>
<li class=""><a class="reference internal" href="#it-s">2.2.1.1. ndarray とは...</a></li>
<li class=""><a class="reference internal" href="#block-of-memory">2.2.1.2. メモリブロック</a></li>
<li class="active"><a class="reference internal" href="#data-types">2.2.1.3. データ型</a><ul>
<li><a class="reference internal" href="#the-descriptor">2.2.1.3.1. デスクリプタ</a></li>
<li><a class="reference internal" href="#example-reading-wav-files">2.2.1.3.2. 例: <code class="docutils literal"><span class="pre">.wav</span></code> ファイルの読み込み</a></li>
<li><a class="reference internal" href="#casting-and-re-interpretation-views">2.2.1.3.3. キャストと再解釈/ビュー</a><ul>
<li><a class="reference internal" href="#casting">2.2.1.3.3.1. キャスト</a></li>
<li><a class="reference internal" href="#re-interpretation-viewing">2.2.1.3.3.2. 再解釈 / ビュー</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#indexing-scheme-strides">2.2.1.4. インデクス方式: ストライド</a><ul>
<li><a class="reference internal" href="#main-point">2.2.1.4.1. 主要な点</a><ul>
<li><a class="reference internal" href="#c-and-fortran-order">2.2.1.4.1.1. C の順序と Fortran の順序</a></li>
<li><a class="reference internal" href="#slicing-with-integers">2.2.1.4.1.2. 整数によるスライス</a></li>
</ul>
</li>
<li><a class="reference internal" href="#example-fake-dimensions-with-strides">2.2.1.4.2. 例: ストライドで次元を偽装する</a></li>
<li><a class="reference internal" href="#broadcasting">2.2.1.4.3. ブロードキャスト</a></li>
<li><a class="reference internal" href="#more-tricks-diagonals">2.2.1.4.4. さらなる工夫: 対角要素</a></li>
<li><a class="reference internal" href="#cpu-cache-effects">2.2.1.4.5. CPU キャッシュの効果</a></li>
<li><a class="reference internal" href="#example-inplace-operations-caveat-emptor">2.2.1.4.6. 例: インプレースな演算 (買手責任)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#findings-in-dissection">2.2.1.5. 解剖により得た知見</a></li>
</ul>
</li>
<li><a class="reference internal" href="#universal-functions">2.2.2. ユニバーサル関数</a><ul>
<li><a class="reference internal" href="#what-they-are">2.2.2.1. とは何か?</a><ul>
<li><a class="reference internal" href="#parts-of-an-ufunc">2.2.2.1.1. ufunc のパーツ</a></li>
<li><a class="reference internal" href="#making-it-easier">2.2.2.1.2. 易しくしてみましょう</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exercise-building-an-ufunc-from-scratch">2.2.2.2. 演習: ufunc をスクラッチから作る</a></li>
<li><a class="reference internal" href="#solution-building-an-ufunc-from-scratch">2.2.2.3. 解答: スクラッチから ufunc を作る</a></li>
<li><a class="reference internal" href="#generalized-ufuncs">2.2.2.4. 一般化された ufunc</a></li>
</ul>
</li>
<li><a class="reference internal" href="#interoperability-features">2.2.3. 相互運用のための機能</a><ul>
<li><a class="reference internal" href="#sharing-multidimensional-typed-data">2.2.3.1. 多次元の型つきデータを共有する</a></li>
<li><a class="reference internal" href="#the-old-buffer-protocol">2.2.3.2. 古い buffer プロトコル</a></li>
<li><a class="reference internal" href="#id3">2.2.3.3. 古い buffer プロトコル</a></li>
<li><a class="reference internal" href="#array-interface-protocol">2.2.3.4. Array インターフェースプロトコル</a></li>
</ul>
</li>
<li><a class="reference internal" href="#array-siblings-chararray-maskedarray-matrix">2.2.4. 配列の競合: <code class="docutils literal"><span class="pre">chararray</span></code>, <code class="docutils literal"><span class="pre">maskedarray</span></code>, <code class="docutils literal"><span class="pre">matrix</span></code></a><ul>
<li><a class="reference internal" href="#chararray-vectorized-string-operations">2.2.4.1. <code class="docutils literal"><span class="pre">chararray</span></code>: 文字列演算のベクトル化</a></li>
<li><a class="reference internal" href="#masked-array-missing-data">2.2.4.2. <code class="docutils literal"><span class="pre">masked_array</span></code> 欠損データ</a><ul>
<li><a class="reference internal" href="#the-mask">2.2.4.2.1. マスク</a></li>
<li><a class="reference internal" href="#domain-aware-functions">2.2.4.2.2. 領域を配慮する関数</a></li>
</ul>
</li>
<li><a class="reference internal" href="#recarray-purely-convenience">2.2.4.3. <code class="docutils literal"><span class="pre">recarray</span></code>: 純粋に便利</a></li>
<li><a class="reference internal" href="#matrix-convenience">2.2.4.4. <code class="docutils literal"><span class="pre">matrix</span></code>: は便利なの?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#summary">2.2.5. まとめ</a></li>
<li><a class="reference internal" href="#contributing-to-numpy-scipy">2.2.6. Numpy/Scipy に貢献するには</a><ul>
<li><a class="reference internal" href="#why">2.2.6.1. なぜ</a></li>
<li><a class="reference internal" href="#reporting-bugs">2.2.6.2. バグレポート</a><ul>
<li><a class="reference internal" href="#good-bug-report">2.2.6.2.1. 良いバグレポート</a></li>
</ul>
</li>
<li><a class="reference internal" href="#contributing-to-documentation">2.2.6.3. ドキュメントへの貢献</a></li>
<li><a class="reference internal" href="#contributing-features">2.2.6.4. 機能の貢献</a></li>
<li><a class="reference internal" href="#how-to-help-in-general">2.2.6.5. 一般的な支援をするには</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>



    <div class="script_container">
    <script>
    (function() {
	var cx = '004523248466141510607:hgv2yimrahw';
	var gcse = document.createElement('script');
	gcse.type = 'text/javascript';
	gcse.async = true;
	gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
	    '//cse.google.com/cse.js?cx=' + cx;
	var s = document.getElementsByTagName('script')[0];
	s.parentNode.insertBefore(gcse, s);
    })();
    </script>
    <div id="___gcse_0"><div class="gsc-control-cse gsc-control-cse-en"><div dir="ltr" class="gsc-control-wrapper-cse"><form accept-charset="utf-8" class="gsc-search-box gsc-search-box-tools"><table class="gsc-search-box" cellpadding="0" cellspacing="0"><tbody><tr><td class="gsc-input"><div id="gsc-iw-id1" class="gsc-input-box"><table class="gstl_50 " id="gs_id50" style="width: 100%; padding: 0px;" cellpadding="0" cellspacing="0"><tbody><tr><td class="gsib_a" id="gs_tti50"><input placeholder="Custom Search" spellcheck="false" dir="ltr" x-webkit-grammar="builtin:search" x-webkit-speech="" id="gsc-i-id1" style="width: 100%; padding: 0px; border: medium none; margin: 0px; height: auto; outline: medium none; background: rgb(255, 255, 255) url(&quot;http://www.google.com/cse/static/images/1x/googlelogo_lightgrey_46x16dp.png&quot;) no-repeat scroll left center; text-indent: 48px;" title="search" name="search" class="gsc-input" size="10" autocomplete="off" lang="en" type="text"></td><td class="gsib_b"><div dir="ltr" id="gs_st50" class="gsst_b"><a style="display: none;" href="javascript:void(0)" class="gsst_a"><span id="gs_cb50" class="gscb_a">×</span></a></div></td></tr></tbody></table></div><input id="bgresponse" name="bgresponse" type="hidden"></td><td class="gsc-search-button"><input title="search" class="gsc-search-button gsc-search-button-v2" src="2.2.%20Numpy%20%E3%81%AE%E5%85%88%E9%80%B2%E7%9A%84%E3%81%AA%E6%A9%9F%E8%83%BD%20%E2%80%94%20Scipy%20lecture%20notes_files/search_box_icon.png" type="image"></td><td class="gsc-clear-button"><div title="clear results" class="gsc-clear-button">&nbsp;</div></td></tr></tbody></table><table class="gsc-branding" cellpadding="0" cellspacing="0"><tbody><tr><td class="gsc-branding-user-defined"></td><td class="gsc-branding-text"><div class="gsc-branding-text">powered by</div></td><td class="gsc-branding-img"><img srcset="https://www.google.com/cse/static/images/2x/googlelogo_grey_46x15dp.png 2x" class="gsc-branding-img" src="2.2.%20Numpy%20%E3%81%AE%E5%85%88%E9%80%B2%E7%9A%84%E3%81%AA%E6%A9%9F%E8%83%BD%20%E2%80%94%20Scipy%20lecture%20notes_files/googlelogo_grey_46x15dp.png"></td></tr></tbody></table></form><div class="gsc-results-wrapper-overlay"><div tabindex="0" class="gsc-results-close-btn"></div><div class="gsc-tabsAreaInvisible"><div class="gsc-tabHeader gsc-inline-block gsc-tabhActive">Custom Search</div><span class="gs-spacer"> </span></div><div class="gsc-tabsAreaInvisible"></div><div class="gsc-above-wrapper-area-invisible"><table class="gsc-above-wrapper-area-container" cellpadding="0" cellspacing="0"><tbody><tr><td class="gsc-result-info-container"><div class="gsc-result-info-invisible"></div></td><td class="gsc-orderby-container"><div class="gsc-orderby-invisible"><div class="gsc-orderby-label gsc-inline-block">Sort by:</div><div class="gsc-option-menu-container gsc-inline-block"><div class="gsc-selected-option-container gsc-inline-block"><div class="gsc-selected-option">Relevance</div><div class="gsc-option-selector"></div></div><div class="gsc-option-menu-invisible"><div class="gsc-option-menu-item gsc-option-menu-item-highlighted"><div class="gsc-option">Relevance</div></div><div class="gsc-option-menu-item"><div class="gsc-option">Date</div></div></div></div></div></td></tr></tbody></table></div><div class="gsc-adBlockInvisible"></div><div class="gsc-wrapper"><div class="gsc-adBlockInvisible"></div><div class="gsc-resultsbox-invisible"><div class="gsc-resultsRoot gsc-tabData gsc-tabdActive"><table class="gsc-resultsHeader" cellpadding="0" cellspacing="0"><tbody><tr><td class="gsc-twiddleRegionCell"><div class="gsc-twiddle"><div class="gsc-title">Web</div></div><div class="gsc-stats"></div><div class="gsc-results-selector gsc-all-results-active"><div title="show one result" class="gsc-result-selector gsc-one-result">&nbsp;</div><div title="show more results" class="gsc-result-selector gsc-more-results">&nbsp;</div><div title="show all results" class="gsc-result-selector gsc-all-results">&nbsp;</div></div></td><td class="gsc-configLabelCell"></td></tr></tbody></table><div><div class="gsc-expansionArea"></div></div></div></div></div></div><div tabindex="0" class="gsc-modal-background-image"></div></div></div></div>
    </div>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="http://www.turbare.net/transl/scipy-lecture-notes/advanced/debugging/index.html" title="2.3. コードのデバッグ">次へ</a></li>
        <li class="right">
          <a href="http://www.turbare.net/transl/scipy-lecture-notes/advanced/advanced_python/index.html" title="2.1. Python の先進的機能を構成するもの">前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="http://www.turbare.net/transl/scipy-lecture-notes/index.html">Scipy lecture notes</a> »</li>
          <li class="nav-item nav-item-1"><a href="http://www.turbare.net/transl/scipy-lecture-notes/advanced/index.html">2. 先進的な話題</a> »</li>
     
    <!-- Insert a menu in the navigation bar -->
    <li class="left">
	<!-- On click toggle the 'tip' on or off-->
	<a onclick="$('.tip').each(function (index, obj) {
			    collapse_tip_div(obj);
		    });
		    $('.tip').addClass('collapsed');
		    $('.left').addClass('transparent');">
	<img src="2.2.%20Numpy%20%E3%81%AE%E5%85%88%E9%80%B2%E7%9A%84%E3%81%AA%E6%A9%9F%E8%83%BD%20%E2%80%94%20Scipy%20lecture%20notes_files/minus.png" alt="Collapse to compact view" style="padding: 1ex;">
	<span class="hiddenlink">Collapse document to compact view</span>
    </a></li>
    <li class="right edit_on_github"><a href="https://github.com/scipy-lectures/scipy-lecture-notes/edit/master/advanced/advanced_numpy/index.rst">Edit
    <span class="tooltip">
	Improve this page:<br>Edit it on Github.
    </span>
    </a>
    </li>

      </ul>
    </div>
    <div class="footer" role="contentinfo">
        © Copyright 2012,2013,2015.
      このドキュメントは <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1 で生成しました。
    </div>
  
<table class="gstl_50 gssb_c" style="width: 2px; display: none; top: 3px; left: -1px; position: absolute;" cellpadding="0" cellspacing="0"><tbody><tr><td class="gssb_f"></td><td style="width: 100%;" class="gssb_e"></td></tr></tbody></table><div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px none; margin: 0px;"><div style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; padding: 0px; border: 0px none; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: normal; font-style: normal; font-size-adjust: none; font-family: STIXSizeOneSym,sans-serif;" id="MathJax_Font_Test"></div></div></body></html>